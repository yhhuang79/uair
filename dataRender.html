<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Creative - Bootstrap 3 Responsive Admin Template">
    <meta name="author" content="GeeksLabs">
    <meta name="keyword" content="Creative, Dashboard, Admin, Template, Theme, Bootstrap, Responsive, Retina, Minimal">
    <!-- <link rel="shortcut icon" href="img/favicon.png"> -->

    <title>TaiwanAir - Taiwan Urban Air Quilty Observe Dashboard</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- bootstrap theme -->
    <!-- <link href="css/bootstrap-theme.css" rel="stylesheet"> -->
    <!--external css-->
    <!-- font icon -->
    <link href="css/elegant-icons-style.css" rel="stylesheet" />
    <link href="css/font-awesome.min.css" rel="stylesheet" />
    <!-- Custom styles -->
    <link href="css/style.css" rel="stylesheet">
    <link href="css/style-responsive.css" rel="stylesheet" />

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
      <script src="js/lte-ie7.js"></script>
    <![endif]-->
    <style media="screen">
    #chartdiv {
      width	: 100%;
      height	: 550px;
    }
    </style>
  </head>

  <body>
  <!-- container section start -->
  <section id="container" class="">
      <!--header start-->

      <header class="header dark-bg">
            <div class="toggle-nav">
                <div class="icon-reorder tooltips" data-original-title="Toggle Navigation" data-placement="bottom"></div>
            </div>

            <!--logo start-->
            <a href="index.html" class="logo">TAIWAN <span class="lite">Air</span></a>
            <!--logo end-->

            <div class="nav search-row" id="top_menu">
                <!--  search form start -->
                <ul class="nav top-menu">
                    <li>
                        <form class="navbar-form">
                            <input class="form-control" placeholder="Search" type="text">
                        </form>
                    </li>
                </ul>
                <!--  search form end -->
            </div>
      </header>
      <!--header end-->

      <!--sidebar start-->
      <aside>
          <div id="sidebar"  class="nav-collapse ">
              <!-- sidebar menu start-->
              <ul class="sidebar-menu">
                  <li class="active">
                      <a class="" href="index.html">
                          <i class="icon_house_alt"></i>
                          <span>空氣品質</span>
                      </a>
                  </li>
                  <li>
                      <a class="" href="leaflet.html">
                          <i class="icon_map"></i>
                          <span>地圖顯示</span>
                      </a>
                  </li>
                  <li>
                      <a class="" href="tables.html">
                          <i class="icon_table"></i>
                          <span>資料表格</span>
                      </a>
                  </li>
                  <li class="sub-menu">
                      <a href="javascript:;" class="">
                          <i class="icon_document_alt"></i>
                          <span>測站統計圖表</span>
                          <span class="menu-arrow arrow_carrot-right"></span>
                      </a>
                      <ul class="sub" id="siteMenu">
                          <li><a class="" href="form_component.html">Form Elements</a></li>
                          <li><a class="" href="form_validation.html">Form Validation</a></li>
                      </ul>
                  </li>
                  <!-- <li>
                      <a class="" href="lassmap.html">
                          <span>LASS開源公益環境感測</span>
                      </a>
                  </li> -->
              </ul>
              <!-- sidebar menu end-->
          </div>
      </aside>
      <!--sidebar end-->

      <!--main content start-->
      <section id="main-content">
          <section class="wrapper">
      		  <div class="row">
      				<div class="col-lg-12">
      					<h3 class="page-header"><i class="fa fa fa-bars"></i> 資料顯示</h3>
      					<ol class="breadcrumb">
      						<li><i class="fa fa-home"></i><a href="index.html">Home</a></li>
      						<li><i class="fa fa-bars"></i>資料顯示</li>
      					</ol>
      				</div>
      			</div>
              <!-- page start-->
            <div class="row">
              <div class="col-lg-12 col-md-12">
                <div class="btn-group" role="group" aria-label="...">
                  <div class="btn-group" role="group">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      站點選擇
                      <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" id="chooseSiteUl">
                      <li value="1"><a href="#">No.1 信義區某商業大樓工程</a></li>
                      <li value="2"><a href="#">No.2 信義區某住宅大樓工程</a></li>
                      <li value="3"><a href="#">No.3 南港區某研究大樓工程</a></li>
                      <li value="4"><a href="#">No.4 中正區某交通建設工程</a></li>
                      <li value="5"><a href="#">No.5 南港區某園區大樓工程</a></li>
                    </ul>
                  </div>

                  <div class="btn-group" role="group">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      日期選擇
                      <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" id="chooseDateUl">
                      <li><a href="#">Dropdown link</a></li>
                      <li><a href="#">Dropdown link</a></li>
                    </ul>
                  </div>
                </div>                <div id="chartdiv"></div>

                <!-- <ul class="dropdown-menu" aria-labelledby="dropdownMenu4">
                  <li><a href="#">Regular link</a></li>
                  <li class="disabled"><a href="#">Disabled link</a></li>
                  <li><a href="#">Another link</a></li>
                </ul> -->

                </div>
            </div>
            <!-- </div> -->

              <!-- page end-->
          </section>
      </section>
      <!--main content end-->

  </section>
  <!-- popup -->
  <!-- Modal -->


  <!-- container section end -->
    <!-- javascripts -->
    <!-- <script src="js/jquery.js"></script> -->
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <!-- nice scroll -->
    <script src="js/jquery.scrollTo.min.js"></script>
    <script src="js/jquery.nicescroll.js" type="text/javascript"></script><!--custome script for all page-->
    <script src="js/scripts.js"></script>
    <script src="js/config.js"></script>
    <!-- amchart -->
    <script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
    <script src="https://www.amcharts.com/lib/3/serial.js"></script>
    <script src="https://www.amcharts.com/lib/3/themes/light.js"></script>
    <script src="https://www.amcharts.com/lib/3/plugins/export/export.min.js"></script>
    <script>
    var chart
      $(function(){

        $( "#chooseSiteUl a" ).on( "click", function( event ) {

            $("#chooseDateUl").empty()
            event.preventDefault();
            // console.log( $( this ).parent().attr('value') );

            site  = $( this ).parent().attr('value');

            No1_dates=["0711","0712","0713","0714"];
            No2_dates=["0721","0722"];
            No3_dates=["0725","0726"];
            No4_dates=["0825","0826"];
            No5_dates=["0706","0720"];

            dateCollector = [No1_dates,No2_dates,No3_dates,No4_dates,No5_dates]

            append(site,dateCollector[site-1])

            function append(site,Dates){

              Dates.forEach(function(element){
                $("#chooseDateUl").append('<li value="'+element+'"><a href="#">'+element+'</a></li>')
              });

            }

            $( "#chooseDateUl a" ).on( "click", function( event ) {
              // console.log("send something")
              time  = "0"+$(this).parent().attr('value');
              // // $.get( baseURL+"api/getAnonymousData", function( data ) {
              // //   $( ".result" ).html( data );
              // //   alert( "Load was performed." );
              // // });
              // $.ajax({
              //   url: baseURL,
              //   type: 'GET',
              //   dataType: 'json',
              //   error: function() { alert('boo!'); },
              //   beforeSend: setHeader
              // }).done(function(data)  {
              //   console.log(data);
              // });
              //
              //
              // function setHeader(xhr) {
              //   xhr.setRequestHeader('siteno', site);
              //   xhr.setRequestHeader('time', time);
              // }
              //

              // $.getJSON(baseURL + "/api/geojsonTI", function(data) {
              //   console.log(data)
              // })

              console.log(time)
              $.post( baseURL+"/api/getAnonymousData", { siteno:site , time: time })
                .done(function( data ) {
                  // console.log(data);

                  var newData = data.dateData.map(function(x){
                    return{
                      date:new Date(x.epoch*1000),
                      RH:x.RH,
                      SolarRadiation: x.SolarRadiation,
                      T: x.T,
                      WBGT: x.WBGT,
                      WS: x.WS,
                      epoch: x.epoch,
                      minNo: x.minNo
                    }
                  })

                  console.log(newData)
                  chart = AmCharts.makeChart("chartdiv", {
                      "type": "serial",
                      // "dataDateFormat": "HH:NN:SS",
                      "theme": "light",
                      "legend": {
                          "useGraphSettings": true
                      },
                      "dataProvider": newData,
                      "synchronizeGrid":true,
                      "valueAxes": [{
                          "id":"v1",
                          "axisColor": "#5D96DB",
                          "axisThickness": 2,
                          "axisAlpha": 1,
                          "position": "left",
                          "offset":100
                      }
                      , {
                          "id":"v2",
                          "axisColor": "#46B29D",
                          "axisThickness": 2,
                          "axisAlpha": 1,
                          "position": "left"
                      }, {
                          "id":"v3",
                          "axisColor": "#DEB54D",
                          "axisThickness": 2,
                          "gridAlpha": 0,
                          "offset": 50,
                          "axisAlpha": 1,
                          "position": "left"
                      }, {
                          "id":"v4",
                          "axisColor": "#E37B46",
                          "axisThickness": 2,
                          "gridAlpha": 0,
                          "offset": 50,
                          "axisAlpha": 1,
                          "position": "right"
                      }, {
                          "id":"v5",
                          "axisColor": "#D95C85",
                          "axisThickness": 2,
                          "gridAlpha": 0,
                          "offset": 50,
                          "axisAlpha": 1,
                          "position": "right",
                          "offset":100
                      }
                      ],
                      "graphs": [{
                          "valueAxis": "v1",
                          "lineColor": "#5D96DB",
                          "bullet": "round",
                          "bulletBorderThickness": 4,
                          "hideBulletsCount": 30,
                          "title": "RH值",
                          "valueField": "RH",
                          "fillAlphas": 0
                      }
                      , {
                          "valueAxis": "v2",
                          "lineColor": "#46B29D",
                          "bullet": "square",
                          "bulletBorderThickness": 1,
                          "hideBulletsCount": 30,
                          "title": "太陽輻射",
                          "valueField": "SolarRadiation",
                          "fillAlphas": 0
                      }, {
                          "valueAxis": "v3",
                          "lineColor": "#DEB54D",
                          "bullet": "triangleUp",
                          "bulletBorderThickness": 1,
                          "hideBulletsCount": 30,
                          "title": "溫度",
                          "valueField": "T",
                          "fillAlphas": 0
                      }, {
                          "valueAxis": "v4",
                          "lineColor": "#E37B46",
                          "bullet": "triangleUp",
                          "bulletBorderThickness": 1,
                          "hideBulletsCount": 30,
                          "title": "WBGT",
                          "valueField": "WBGT",
                          "fillAlphas": 0
                      }, {
                          "valueAxis": "v5",
                          "lineColor": "#D95C85",
                          "bullet": "triangleUp",
                          "bulletBorderThickness": 1,
                          "hideBulletsCount": 30,
                          "title": "風速",
                          "valueField": "WS",
                          "fillAlphas": 0
                      }
                      ],
                      "chartScrollbar": {
                          // "graph": "v1",
                          // "scrollbarHeight": 80,
                          // "backgroundAlpha": 0,
                          // "selectedBackgroundAlpha": 0.1,
                          // "selectedBackgroundColor": "#888888",
                          // "graphFillAlpha": 0,
                          // "graphLineAlpha": 0.5,
                          // "selectedGraphFillAlpha": 0,
                          // "selectedGraphLineAlpha": 1,
                          // "autoGridCount": true,
                          // "color": "#AAAAAA"
                      },
                      "chartCursor": {
                          "cursorPosition": "mouse"
                      },
                      "categoryField": "date",
                      "categoryAxis": {
                          "minPeriod": "mm",
                          "parseDates": true
                      },
                      "export": {
                        "enabled": false,
                          "position": "bottom-right"
                       }
                  });

                  function zoomChart(){
                    chart.zoomToDates((newData[0].epoch*1000),(newData[10].epoch*1000));
                  }
                  chart.addListener("rendered", zoomChart);




                });

            })



        });

        // var parameter = QueryString();
        // console.log(parameter)

          $('#chooseDateBox').modal('show');

        // If: get site & date
        // Show the chartData and close box
        // Else: not get site &date
        // Show the box

    function QueryString(){
      // This function is anonymous, is executed immediately and
      // the return value is assigned to QueryString!
      var query_string = {};
      var query = window.location.search.substring(1);
      var vars = query.split("&");
      for (var i=0;i<vars.length;i++) {
        var pair = vars[i].split("=");
            // If first entry with this name
        if (typeof query_string[pair[0]] === "undefined") {
          query_string[pair[0]] = decodeURIComponent(pair[1]);
            // If second entry with this name
        } else if (typeof query_string[pair[0]] === "string") {
          var arr = [ query_string[pair[0]],decodeURIComponent(pair[1]) ];
          query_string[pair[0]] = arr;
            // If third or later entry with this name
        } else {
          query_string[pair[0]].push(decodeURIComponent(pair[1]));
        }
      }
      return query_string;
    }
    })
    </script>


  </body>
</html>
