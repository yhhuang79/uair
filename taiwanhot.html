<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Creative - Bootstrap 3 Responsive Admin Template">
    <meta name="author" content="GeeksLabs">
    <meta name="keyword" content="Creative, Dashboard, Admin, Template, Theme, Bootstrap, Responsive, Retina, Minimal">
    <link rel="shortcut icon" href="img/favicon.png">

    <title>戶外高氣溫作業場所勞動者資訊平台</title>

    <!-- Bootstrap CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- bootstrap theme -->
    <link href="css/bootstrap-theme.css" rel="stylesheet">
    <!--external css-->
    <!-- font icon -->
    <link href="css/elegant-icons-style.css" rel="stylesheet" />
    <link href="css/font-awesome.min.css" rel="stylesheet" />
    <!-- full calendar css-->
    <link href="assets/fullcalendar/fullcalendar/bootstrap-fullcalendar.css" rel="stylesheet" />
	  <link href="assets/fullcalendar/fullcalendar/fullcalendar.css" rel="stylesheet" />
    <!-- easy pie chart-->
    <link href="assets/jquery-easy-pie-chart/jquery.easy-pie-chart.css" rel="stylesheet" type="text/css" media="screen"/>
    <!-- owl carousel -->
    <!-- <link rel="stylesheet" href="css/owl.carousel.css" type="text/css">
	  <link href="css/jquery-jvectormap-1.2.2.css" rel="stylesheet"> -->
    <!-- leaflet map -->
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css">
    <link rel="stylesheet" href="http://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.css">
    <link rel="stylesheet" href="http://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.Default.css">
    <link rel="stylesheet" href="http://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.24.0/L.Control.Locate.css">
    <link rel="stylesheet" href="assets/leaflet-groupedlayercontrol/leaflet.groupedlayercontrol.css">
    <!-- Custom styles -->
	  <link rel="stylesheet" href="css/fullcalendar.css">
	  <link href="css/widgets.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/style-responsive.css" rel="stylesheet" />
	  <link href="css/xcharts.min.css" rel=" stylesheet">
	  <link href="css/jquery-ui-1.10.4.min.css" rel="stylesheet">
    <style >
    #chartdiv {
width: 100%;
height: 200px;
}

    </style>
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
      <script src="js/lte-ie7.js"></script>
    <![endif]-->


  </head>

  <body>
  <!-- container section start -->
  <section id="container" class="">


      <header class="header dark-bg navbar navbar-default">
            <div class="toggle-nav">
                <div class="icon-reorder tooltips" data-original-title="Toggle Navigation" data-placement="bottom"></div>
            </div>

            <!--logo start-->
            <a href="index.html" class="logo">勞動部 <span class="lite">高溫氣溫網站</span></a>
            <!--logo end-->

            <div class="nav search-row" id="top_menu">
                <!--  search form start -->
                <ul class="nav top-menu">
                    <li>
                        <form class="navbar-form">
                            <input class="form-control" placeholder="Search" type="text">
                        </form>
                    </li>
                </ul>
                <!--  search form end -->
            </div>


            <ui class="nav navbar-nav navbar-right" >
              <img src="img/Logo-MOL.jpg" class="img-responsive" alt="Cinque Terre" style="height:80px;float:right;margin-right: -15px;">
              <img src="img/Logo-RCEC.jpg" class="img-responsive" alt="Cinque Terre" style="height:80px;float:right;">
              <img src="img/Logo-IIS.jpg" class="img-responsive" alt="Cinque Terre" style="height:80px;float:right">
            </ui>


      </header>
      <!--header end-->

      <!--sidebar start-->
      <!-- <aside>
          <div id="sidebar"  class="nav-collapse ">
              <ul class="sidebar-menu">
                  <li class="active">
                      <a class="" href="index.html">
                          <i class="icon_house_alt"></i>
                          <span>空氣品質</span>
                      </a>
                  </li>
                  <li>
                      <a class="" href="leaflet.html">
                          <i class="icon_map"></i>
                          <span>地圖顯示</span>
                      </a>
                  </li>
                  <li>
                      <a class="" href="tables.html">
                          <i class="icon_table"></i>
                          <span>資料表格</span>
                      </a>
                  </li>
                  <li class="sub-menu">
                      <a href="javascript:;" class="">
                          <i class="icon_document_alt"></i>
                          <span>測站統計圖表</span>
                          <span class="menu-arrow arrow_carrot-right"></span>
                      </a>
                      <ul class="sub" id="siteMenu">
                          <li><a class="" href="form_component.html">Form Elements</a></li>
                          <li><a class="" href="form_validation.html">Form Validation</a></li>
                      </ul>
                  </li>
                  <li>
                      <a class="" href="lassmap.html">
                          <span>LASS開源公益環境感測</span>
                      </a>
                  </li>
                  <li>
                     <img src="img/Logo-MOL.jpg" class="img-responsive" alt="Cinque Terre">
                  </li>
                  <li>
                     <img src="img/Logo-IIS.jpg" class="img-responsive" alt="Cinque Terre">
                  </li>
                  <li>
                     <img src="img/Logo-RCEC.jpg" class="img-responsive" alt="Cinque Terre">
                  </li>

              </ul>
          </div>
      </aside> -->
      <!--sidebar end-->

      <!--main content start-->
      <section id=" content">
          <section class="wrapper">
              <!--overview start-->
			  <div class="row">
				<div class="col-lg-12">
					<h3 class="page-header" id="sitelocation"><i class="fa fa-laptop"></i> Dashboard</h3>
					<ol class="breadcrumb">
						<li><i class="fa fa-home"></i><a href="index.html">Home</a></li>
						<li><i class="fa fa-laptop"></i> WBGT溫度分析 </li>
					</ol>
				</div>
			</div>

            <div class="row">
				<div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
					<div class="info-box lass-blue-bg">
						<div class="circle" id="box-1K">-.--</div>
						<div class="title">自身周圍1公里溫度</div>
					</div><!--/.info-box-->
				</div><!--/.col-->

				<div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
					<div class="info-box lass-blue-bg">
						<div class="circle" id="box-PM10">-.--</div>
						<div class="title">自身周圍10公尺溫度</div>
					</div><!--/.info-box-->
				</div><!--/.col-->

				<div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
					<div class="info-box lass-blue-bg">
						<div class="circle" id="box-PM25">-.--</div>
						<div class="title">全省即時平均溫度</div>
					</div><!--/.info-box-->
				</div><!--/.col-->

				<div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
					<div class="info-box lass-blue-bg">
						<div class="circle" id="box-WBGT">-.--</div>
						<div class="title">全省測站即時最高溫</div>
					</div><!--/.info-box-->
				</div><!--/.col-->

			</div><!--/.row-->


           <div class="row">
		    <div class="col-lg-9 col-md-12">

					<div class="panel panel-default">
						<div class="panel-heading">
							<h2><i class="fa fa-map-marker red"></i><strong>觀測站地圖</strong></h2>
							<div class="panel-actions">
								<!-- <a href="index.html#" class="btn-setting"><i class="fa fa-rotate-right"></i></a>
								<a href="index.html#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
								<a href="index.html#" class="btn-close"><i class="fa fa-times"></i></a> -->
							</div>
						</div>
						<div class="panel-body-map">
							<div id="map" style="height:380px;"></div>
						</div>

					</div>
				</div>
              <div class="col-md-3">

                					<div class="panel panel-default">
                						<div class="panel-heading">
                							<h2><i class="fa fa-map-marker red"></i><strong>自身周圍即時空氣品質 </strong></h2>
                							<div class="panel-actions">
                								<!-- <a href="index.html#" class="btn-setting"><i class="fa fa-rotate-right"></i></a>
                								<a href="index.html#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
                								<a href="index.html#" class="btn-close"><i class="fa fa-times"></i></a> -->
                							</div>
                						</div>
                						<div class="panel-body" style="height=380px;">
                              <pre>
                              LaborWBGT 溫度顏色定義


                              36.1°C ~ 40°C 紫色, 淺色漸層至深色


                              32.1°C ~ 36°C 紅色, 淺色漸層至深色


                              24.1°C ~ 32°C 棕色, 淺色漸層至深色


                              11.1°C ~ 24°C 綠色, 深色漸層至淺色


                                -1°C ~ 11°C 藍色, 深色漸層至淺色
                              </pre>
                             </div>
                              </div>
                						</div>

                					</div>

		  <!-- Today status end -->



            			<div class="row">

            				<div class="col-lg-9 col-md-12">
            					<div class="panel panel-default">
            						<div class="panel-heading">
            							<h2><i class="fa fa-flag-o red"></i><strong>勞工之LaborMotion手機即時感測資料曲線圖</strong></h2>
            							<div class="panel-actions">
            								<!-- <a href="index.html#" class="btn-setting"><i class="fa fa-rotate-right"></i></a>
            								<a href="index.html#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
            								<a href="index.html#" class="btn-close"><i class="fa fa-times"></i></a> -->
            							</div>
            						</div>
            						<div class="panel-body">
                          <!-- Nav tabs -->
                          <ul class="nav nav-tabs" role="tablist">
                            <li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">Home</a></li>
                            <li role="presentation"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">Profile</a></li>
                            <li role="presentation"><a href="#messages" aria-controls="messages" role="tab" data-toggle="tab">Messages</a></li>
                            <li role="presentation"><a href="#settings" aria-controls="settings" role="tab" data-toggle="tab">Settings</a></li>
                          </ul>

                          <div class="tab-content">
                            <div role="tabpanel" class="tab-pane fade in active" id="home">
                              <div id="chartdiv"></div>
                            </div>
                            <div role="tabpanel" class="tab-pane fade" id="profile">
                              <div id="chartdiv"></div>

                            </div>
                            <div role="tabpanel" class="tab-pane fade" id="messages">
                              <div id="chartdiv"></div>

                            </div>
                            <div role="tabpanel" class="tab-pane fade" id="settings">
                              <div id="chartdiv"></div>

                            </div>
                          </div>

            						</div>

            					</div>

            				</div><!--/col-->
            				<div class="col-md-3 ">
                      <div class="row">
                        <div class="panel panel-default">
              						<div class="panel-heading">
              							<h2><i class="fa fa-map-marker red"></i><strong>勞工活動模式偵測</strong></h2>
              							<div class="panel-actions">
              								<!-- <a href="index.html#" class="btn-setting"><i class="fa fa-rotate-right"></i></a>
              								<a href="index.html#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
              								<a href="index.html#" class="btn-close"><i class="fa fa-times"></i></a> -->
              							</div>
              						</div>
              						<div class="panel-body">
                            <div id="labor_active" style="height:230px">

                            </div>
              						</div>
              					</div>
                      </div>
                    </div>

                  </div>

                  <div class="row">
                    <div class="col-lg-12 col-md-12">
                      <div class="panel panel-default">
                        <div class="panel-heading">
                          <h2><i class="fa fa-flag-o red"></i><strong>熱危害預警與建議</strong></h2>
                          <div class="panel-actions">
                            <!-- <a href="index.html#" class="btn-setting"><i class="fa fa-rotate-right"></i></a>
                            <a href="index.html#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
                            <a href="index.html#" class="btn-close"><i class="fa fa-times"></i></a> -->
                          </div>
                        </div>
                        <div class="panel-body" style="height:150px">
                          <!-- Nav tabs -->
                        </div>

                      </div>

                    </div><!--/col-->

                  </div>
                <!-- statics end -->
<!-- unused -->
                  <div class="widget-foot">
                    <!-- Footer goes here -->
                  </div>
                </div>
              </div>

            </div>

          </div>
              <!-- project team & activity end -->

          </section>
      </section>
      <!--main content end-->
  </section>
  <!-- container section start -->

  <!-- javascripts -->
  <script src="js/jquery.js"></script>
	<script src="js/jquery-ui-1.10.4.min.js"></script>
  <script src="js/jquery-1.8.3.min.js"></script>
  <script type="text/javascript" src="js/jquery-ui-1.9.2.custom.min.js"></script>
  <!-- bootstrap -->
  <script src="js/bootstrap.min.js"></script>
  <!-- nice scroll -->
  <script src="js/jquery.scrollTo.min.js"></script>
  <script src="js/jquery.nicescroll.js" type="text/javascript"></script>
  <!-- charts scripts -->
  <script src="assets/jquery-knob/js/jquery.knob.js"></script>
  <script src="js/jquery.sparkline.js" type="text/javascript"></script>
  <script src="assets/jquery-easy-pie-chart/jquery.easy-pie-chart.js"></script>
  <script src="js/owl.carousel.js" ></script>
  <!-- jQuery full calendar -->
  <script src="js/fullcalendar.min.js"></script> <!-- Full Google Calendar - Calendar -->
	<script src="assets/fullcalendar/fullcalendar/fullcalendar.js"></script>
  <!--script for this page only-->
  <script src="js/calendar-custom.js"></script>
	<script src="js/jquery.rateit.min.js"></script>
  <!-- custom select -->
  <script src="js/jquery.customSelect.min.js" ></script>
	<script src="assets/chart-master/Chart.js"></script>

  <!--custome script for all page-->
  <script src="js/scripts.js"></script>
  <script src="js/config.js"></script>

  <!-- custom script for this page-->
  <script src="js/sparkline-chart.js"></script>
  <script src="js/easy-pie-chart.js"></script>
	<!-- <script src="js/jquery-jvectormap-1.2.2.min.js"></script>
	<script src="js/jquery-jvectormap-world-mill-en.js"></script> -->
	<script src="js/xcharts.min.js"></script>
	<script src="js/jquery.autosize.min.js"></script>
	<script src="js/jquery.placeholder.min.js"></script>
	<script src="js/gdp-data.js"></script>
	<script src="js/morris.min.js"></script>
	<script src="js/sparklines.js"></script>
	<script src="js/charts.js"></script>
	<script src="js/jquery.slimscroll.min.js"></script>

  <!-- leaflet map -->
  <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
  <script src="http://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js"></script>
  <script src="http://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.24.0/L.Control.Locate.js"></script>
  <script src="assets/leaflet-groupedlayercontrol/leaflet.groupedlayercontrol.js"></script>
  <!-- <script src="assets/leaflet-heatmap/heatmap.js"></script>
  <script src="assets/leaflet-heatmap/leaflet-heatmap.js"></script> -->
  <script src="http://leaflet.github.io/Leaflet.heat/dist/leaflet-heat.js"></script>
  <script src="http://leaflet.github.io/Leaflet.markercluster/example/realworld.10000.js"></script>

  <script src="http://www.amcharts.com/lib/3/amcharts.js"></script>
  <script src="http://www.amcharts.com/lib/3/serial.js"></script>
  <script src="http://www.amcharts.com/lib/3/themes/light.js"></script>
  <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>

  <script>

      //knob
      $(function() {
        $(".knob").knob({
          'draw' : function () {
            $(this.i).val(this.cv + '%')
          }
        })
      });

      //carousel
      $(document).ready(function() {
          $("#owl-slider").owlCarousel({
              navigation : true,
              slideSpeed : 300,
              paginationSpeed : 400,
              singleItem : true

          });
      });

      //custom select box

      $(function(){
          $('select.styled').customSelect();
      });

  $(function(){
    var markerMap = {};
    var map;
    /* Basemap Layers */
    var mapquestOSM = L.tileLayer("http://{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png", {
      maxZoom: 19,
      subdomains: ["otile1", "otile2", "otile3", "otile4"],
      attribution: 'Tiles courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png">. Map data (c) <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> contributors, CC-BY-SA.'
    });

    /* Single marker cluster layer to hold all clusters */
    var markerClusters = new L.MarkerClusterGroup({
      spiderfyOnMaxZoom: true,
      showCoverageOnHover: false,
      zoomToBoundsOnClick: true,
      disableClusterinAtZoom: 8
    });


    var map = L.map('map',{
      maxZoom:13
    }).setView([25.0391667, 121.525], 12);

    var tiles = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
    }).addTo(map);

    addressPoints = addressPoints.map(function (p) { return [p[0], p[1]]; });
    var dataset;
    $.getJSON("http://taiwanair.plash.tw/api/geojsonTI", function(data) {
      // console.log(data);
      dataset = data.features.map(function (p) {
        return [p.geometry.coordinates[1],p.geometry.coordinates[0] ,p.properties.wbgto_max*(1/35)] ;
      });

      // var heat = L.heatLayer(dataset,{radius:150,gradient:  {
      //   0.4: 'blue', 0.65: 'lime', 0.9: 'red'}
      // }
      // ).addTo(map);
      var heat = L.heatLayer(dataset,{radius:88,blur:50}
      ).addTo(map);


      map.locate({setView:true,maxZoom:12});
      map.on('locationerror', function(e){
        console.log("Sorry, We can not get your current loaction.");
      });

      map.on('locationfound', function (e) {
        var radius = e.accuracy / 2;
        var myLocationIcon = new L.icon({iconUrl: 'img/currentLoc.png',iconAnchor:[14, 38]});
			  L.marker(e.latlng, {icon: myLocationIcon}).addTo(map)
				    .bindPopup("You are within " + radius + " meters from this point").openPopup();
			  L.circle(e.latlng, radius).addTo(map);
        //currently , using absolutely node server url.
        $.getJSON("http://taiwanair.plash.tw/api/geojsonTI", function(data) {
          console.log(data);
          var nearbySiteName, nearby1K, nearby10M, averageTmp=0, highestTmp=0, d=300000 ,d_10m=10,count=0;
          var geojson = L.geoJson(data, {
            onEachFeature: function (feature, layer) {
                //console.log(feature.geometry.coordinates +":"+ e.latlng);
                console.log(feature);
                var slatlng = L.latLng(feature.geometry.coordinates[1],feature.geometry.coordinates[0]);
                if(slatlng.distanceTo(e.latlng) < d){
                  nearbySiteName = feature.properties.SiteName;
                  nearby1K = (feature.properties.wbgto_max);
                  nearby10M = (feature.properties.wbgto_max);
                  averageTmp = (feature.properties.wbgto_max);
                  highestTmp = (feature.properties.wbgto_max);
                  d = slatlng.distanceTo(e.latlng);
                  //console.log(d);
                }
                if(slatlng.distanceTo(e.latlng) < d_10m) {
                  nearby10M = (feature.properties.wbgto_max);
                  d_10m = slatlng.distanceTo(e.latlng);
                }

                averageTmp=averageTmp+feature.properties.wbgto_max;
                count=count+1;

                if(highestTmp<  feature.properties.wbgto_max){
                  highestTmp  = feature.properties.wbgto_max;
                }
            }

          });
          console.log("nearbySiteName:"+nearby1K);
          averageTmp  = (averageTmp  / count );
          $('#sitelocation').html("<i class=\"fa fa-laptop\"></i> 觀測站："+nearbySiteName);
          $("#box-1K").html(nearby1K.toFixed(1));

          if((parseFloat(nearby1K)>51) && (parseFloat(nearby1K)<100)){
            $("#box-PSI").css("background-color","#ffd600");
          } else if ((parseFloat(nearby1K)>101) && (parseFloat(nearby1K)<199)) {
            $("#box-PSI").css("background-color","#ff5252");
          } else if ((parseFloat(nearby1K)>200) && (parseFloat(nearby1K)<299)) {
            $("#box-PSI").css("background-color","#795548");
          } else if (parseFloat(nearby1K)>300) {
            $("#box-PSI").css("background-color","#673ab7");
          }

          var nearbyPM10 = nearby10M;

          $("#box-PM10").html(nearbyPM10.toFixed(1));
          if((parseFloat(nearbyPM10)>51) && (parseFloat(nearbyPM10)<150)){
            $("#box-PM10").css("background-color","#ffd600");
          } else if ((parseFloat(nearbyPM10)>151) && (parseFloat(nearbyPM10)<350)) {
            $("#box-PM10").css("background-color","#ff5252");
          } else if ((parseFloat(nearbyPM10)>351) && (parseFloat(nearbyPM10)<420)) {
            $("#box-PM10").css("background-color","#795548");
          } else if (parseFloat(nearbyPM10)>421) {
            $("#box-PM10").css("background-color","#673ab7");
          }

          var nearbyPM25  =28;
          $("#box-PM25").html(nearbyPM25.toFixed(1));
          if((parseFloat(nearbyPM25)>36) && (parseFloat(nearbyPM25)<53)){
            $("#box-PM25").css("background-color","#ffd600");
          } else if ((parseFloat(nearbyPM25)>54) && (parseFloat(nearbyPM25)<64)) {
            $("#box-PM25").css("background-color","#ff5252");
          } else if ((parseFloat(nearbyPM25)>65) && (parseFloat(nearbyPM25)<70)) {
            $("#box-PM25").css("background-color","#795548");
          } else if (parseFloat(nearbyPM25)>71) {
            $("#box-PM25").css("background-color","#673ab7");
          }

          var nearbyWBGT  = highestTmp;
          $("#box-WBGT").html(nearbyWBGT.toFixed(1));
          if((parseFloat(nearbyWBGT)>26.7) && (parseFloat(nearbyWBGT)<29.3)){
            $("#box-WBGT").css("background-color","#ffd600");
          } else if ((parseFloat(nearbyWBGT)>29.4) && (parseFloat(nearbyWBGT)<31.0)) {
            $("#box-WBGT").css("background-color","#ff5252");
          } else if ((parseFloat(nearbyWBGT)>31.1) && (parseFloat(nearbyWBGT)<32.1)) {
            $("#box-WBGT").css("background-color","#795548");
          } else if (parseFloat(nearbyWBGT)>32.2) {
            $("#box-WBGT").css("background-color","#673ab7");
          }


        });
      });
    });
    //
    // var heat = L.heatLayer(dataset,{radius:50}
    // ).addTo(map);


    // Setup map width
    $('#map').width($('.panel-body-map').width());

    // Get Air Quilty Data
    // $.getJSON("http://taiwanair.plash.tw/api/geojsonTI", function(data) {
    //   var listTable;      // var geojson = L.geoJson(data, {
    //   //
    //   //   onEachFeature: function (feature, layer) {
    //   //     //console.log("feture id : " + JSON.stringify(layer));
    //   //     content = "<table class='table table-striped table-bordered table-condensed'>"
    //   //       + "<tr><th>測站名稱</th><td>" + feature.properties.SiteName + "監測站"
    //   //       + "</td></tr>" + "<tr><th>縣市</th><td>" + feature.properties.County
    //   //       + "</td></tr>" + "<tr><th>狀態</th><td>" + feature.properties.Status
    //   //       + "</td></tr>" + "<tr><th>資料更新時間</th><td>" + feature.properties.PublishTime
    //   //       + "</td></tr>" + "<tr><th>地址</th><td>" + feature.properties.SiteAddres
    //   //       + "</td></tr>" + "<table>";
    //   //
    //   //     listTable += "<tr><td>"
    //   //       + "<img src=\"img/Taiwan.png\" style=\"height:18px; margin-top:-2px;\"></td>"
    //   //       + "<td>" + feature.properties.SiteName + "</td>"
    //   //       + "<td>" + feature.properties.PM10 + "</td>"
    //   //       + "<td>" + feature.properties['PM2.5'] + "</td>"
    //   //       + "<td><div class=\"progress thin\">"
    //   //       +  "<div class=\"progress-bar progress-bar-danger\""
    //   //       +  " role=\"progressbar\" aria-valuenow=\""+ feature.properties.PSI
    //   //       + "\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: "
    //   //       + feature.properties.PSI + "% \"></div>"
    //   //       + "<div class=\"progress-bar progress-bar-info\""
    //   //       + " role=\"progressbar\" aria-valuenow=\""
    //   //       + (100 - feature.properties.PSI) + "\" aria-valuemin=\"0\""
    //   //       + " aria-valuemax=\"100\" style=\"width: "
    //   //       + (100-feature.properties.PSI) + "%\"></div></div>"
    //   //       + "<span class=\"sr-only\">" + feature.properties.PSI + "</span>"
    //   //       + "</td></tr>";
    //   //
    //   //     siteMenu += "<li><a class=\"\" href=\"chart-chartjs.html?site="
    //   //       + feature.properties.SiteName + "\">"
    //   //       + feature.properties.SiteName + "</a></li>";
    //   //     layer.bindPopup(content);
    //   //
    //   //     // Click event
    //   //     layer.on('click', function (e) {
    //   //       $("#box-PSI").html(feature.properties.PSI);
    //   //       $("#box-PM10").html(feature.properties.PM10);
    //   //       $("#box-PM25").html(feature.properties['PM2.5']);
    //   //       $("#box-WBGT").html(feature.properties.WBGT.toFixed(1));
    //   //
    //   //       var url = "http://taiwanair.plash.tw/api/geojsonTI" + feature.properties.SiteName;
    //   //       $.getJSON(url, function(data) {
    //   //         //alert(JSON.stringify(data));
    //   //         $("#todayspark1").sparkline(data.PSI.reverse(), {
    //   //             type: 'line',
    //   //             width: '250',
    //   //             height: '30',
    //   //             lineColor: '#999',
    //   //             fillColor: '#ffd4aa'});
    //   //
    //   //
    //   //         $("#todayspark2").sparkline(data.SO2.reverse(), {
    //   //             type: 'line',
    //   //             width: '250',
    //   //             height: '30',
    //   //             lineColor: '#C5CED6',
    //   //             fillColor: '#ffffaa'});
    //   //
    //   //         $("#todayspark3").sparkline(data.CO.reverse(), {
    //   //             type: 'line',
    //   //             width: '250',
    //   //             height: '30',
    //   //             lineColor: '#436B91',
    //   //             fillColor: '#d4ffaa'});
    //   //
    //   //         $("#todayspark4").sparkline(data.O3.reverse(), {
    //   //             type: 'line',
    //   //             width: '250',
    //   //             height: '30',
    //   //             lineColor: '#486b60',
    //   //             fillColor: '#aaffff'});
    //   //
    //   //         $("#todayspark5").sparkline(data.NO2.reverse(), {
    //   //             type: 'line',
    //   //             width: '250',
    //   //             height: '30',
    //   //             lineColor: '#436B91',
    //   //             fillColor: '#aad4ff'});
    //   //       });
    //   //     });
    //   //   }
    //   // });
    //
    //
    //
    //   $('#observeStationList').html(listTable);
    //   $('#siteMenu').html(siteMenu);
    //   map.locate({setView: true, maxZoom: 16});
    // });

    startDemo();
  });


  var interval;
var websocket;

var websocketEchoServerUri = "ws://echo.websocket.org/";
var chartData = []; //will be updated by our simulated server
var serverLog = document.getElementById("server-log");
var chart = AmCharts.makeChart("chartdiv", {
  "type": "serial",
  "theme": "light",
  "dataDateFormat": "YYYY/MM/DD JJ:NN",
  "valueAxes": [{
    "id": "v1",
    "position": "left"
  }],
  "graphs": [{
    "id": "g1",
    "bullet": "round",
    "valueField": "value",
    "balloonText": "[[category]]: [[value]]"
  }],
  "categoryField": "date",
  "categoryAxis": {
    "parseDates": true,
    "equalSpacing": true,
    "dashLength": 1,
    "minorGridEnabled": true
  },
  "dataProvider": chartData
});

function startDemo() {
  websocket = initWebSocket(websocketEchoServerUri);
}

function endDemo() {
  startButton.disabled = "";
  endButton.disabled = "disabled";
  websocket.close();
}

function initWebSocket(wsUri) {
  var ws = new WebSocket(wsUri);
  ws.onopen = onConnect;
  ws.onclose = onClose;
  ws.onerror = onError;
  ws.onmessage = updateChart;
  return ws;
}

/*
 * Called during the onmessage event. Your application will need
 * to parse  your websocket server's response into a data object
 * or array of dataObjects your chart expects
 */
function updateChart(wsEvent) {
  // var newData = JSON.parse(wsEvent.data);
  // // console.log("get new data:"+newData);
  // chartData.push.apply(chartData, newData);
  // // keep only 50 datapoints on screen for the demo
  // if (chartData.length > 50) {
  //   chartData.splice(0, chartData.length - 50);
  // }
  // writeToScreen("<span style='color: blue'>Received: " + wsEvent.data + "</span>");
  // chart.validateData(); //call to redraw the chart with new data
}

function onConnect(wsEvent) {
  writeToScreen("Server connection successful. Listening for data now.");
  interval = setInterval(getDataFromServer, 2000); //we're simulating a datafeed by calling our getDataFromServer method every 2 seconds
}

function onError(wsEvent) {
  writeToScreen("<span style='color: red'>ERROR:" + wsEvent + "</span>");
}

function onClose(wsEvent) {
  writeToScreen("Server connection closed");
  clearInterval(interval);
}

//For debug messaging
function writeToScreen(message) {
  var pre = document.createElement("p");
  pre.style.wordWrap = "break-word";
  pre.innerHTML = message;
}

/*
 * This simulates a data response from the server
 * using websocket.org's echo server. The method generates
 * a random sized array of values and writes it to
 * the server in the form of a JSON string,
 * which will be echoed back to the client
 */
function getDataFromServer() {
  var newDate;
  var newValue;
  var newData = [];
  var newDataSize = Math.round(Math.random() + 3) + 1;

  if (chartData.length) {
    newDate = new Date(chartData[chartData.length - 1].date);
  } else {
    newDate = new Date();
  }

  for (var i = 0; i < newDataSize; ++i) {
    newValue = Math.round(Math.random() * (4000 + i)) +  + i;
    newDate.setDate(newDate.getDate() + 1);

    newData.push({
      date: newDate,
      value: newValue
    });
  }

  websocket.send(JSON.stringify(newData));
}

var socket = io.connect('http://140.109.18.141:3000');
var a;
socket.on('news', function (data) {
  a = data;
  // var newData = data.hello.hello.new_val.dataset.map(p=>({
  //   value:p.GravityX,
  //   // GRAVITY_Y:p.GRAVITY[1],
  //   // GRAVITY_Z:p.GRAVITY[2,
  //   date:p.Time
  // }));

  var newData = [{
    value:data.hello.hello.new_val.dataset.GravityX,
    date:data.hello.hello.new_val.dataset.Time,

  }];
   console.log("Received data");
  chartData.push.apply(chartData, newData);
  // keep only 50 datapoints on screen for the demo
  if (chartData.length > 300) {
    chartData.splice(0, chartData.length - 300);
  }
  // writeToScreen("<span style='color: blue'>Received: " + wsEvent.data + "</span>");
  chart.validateData(); //call to redraw the chart with new data
  // socket.emit('my other event', { my: 'data' });
});

  </script>

  </body>
</html>
