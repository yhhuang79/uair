<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Creative - Bootstrap 3 Responsive Admin Template">
    <meta name="author" content="GeeksLabs">
    <meta name="keyword" content="Creative, Dashboard, Admin, Template, Theme, Bootstrap, Responsive, Retina, Minimal">
    <link rel="shortcut icon" href="img/favicon.png">

    <title>戶外高氣溫作業場所勞動者資訊平台</title>

    <!-- Bootstrap CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- bootstrap theme -->
    <link href="css/bootstrap-theme.css" rel="stylesheet">
    <!--external css-->
    <!-- font icon -->
    <link href="css/elegant-icons-style.css" rel="stylesheet" />
    <link href="css/font-awesome.min.css" rel="stylesheet" />
    <!-- full calendar css-->
    <link href="assets/fullcalendar/fullcalendar/bootstrap-fullcalendar.css" rel="stylesheet" />
	  <link href="assets/fullcalendar/fullcalendar/fullcalendar.css" rel="stylesheet" />
    <!-- easy pie chart-->
    <link href="assets/jquery-easy-pie-chart/jquery.easy-pie-chart.css" rel="stylesheet" type="text/css" media="screen"/>
    <!-- owl carousel -->
    <!-- <link rel="stylesheet" href="css/owl.carousel.css" type="text/css">
	  <link href="css/jquery-jvectormap-1.2.2.css" rel="stylesheet"> -->
    <!-- leaflet map -->
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css">
    <link rel="stylesheet" href="http://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.css">
    <link rel="stylesheet" href="http://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.Default.css">
    <link rel="stylesheet" href="http://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.24.0/L.Control.Locate.css">
    <link rel="stylesheet" href="assets/leaflet-groupedlayercontrol/leaflet.groupedlayercontrol.css">
    <link rel="stylesheet" href="css/easy-button.css">

    <!-- Custom styles -->
	  <link rel="stylesheet" href="css/fullcalendar.css">
	  <link href="css/widgets.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/style-responsive.css" rel="stylesheet" />
	  <link href="css/xcharts.min.css" rel=" stylesheet">
	  <link href="css/jquery-ui-1.10.4.min.css" rel="stylesheet">
    <style >
    #chartdiv {
    width: 100%;
    height: 300px;
  }
  #chart2div {
    width: 100%;
    height: 300px;
  }
  #chart3div {
    width: 100%;
    height: 300px;
  }

    </style>

  </head>

  <body>
  <!-- container section start -->
  <section id="container" class="">


      <header class="header dark-bg navbar navbar-default">
            <div class="toggle-nav">
                <div class="icon-reorder tooltips" data-original-title="Toggle Navigation" data-placement="bottom"></div>
            </div>

            <!--logo start-->
            <a href="index.html" class="logo">勞動部 <span class="lite">戶外高氣溫作業場所勞動者資訊平台</span></a>
            <!--logo end-->

            <ui class="nav navbar-nav navbar-right" >
              <img src="img/Logo-MOL.jpg" class="img-responsive" alt="Cinque Terre" style="height:80px;float:right;margin-right: -15px;">
              <img src="img/Logo-RCEC.jpg" class="img-responsive" alt="Cinque Terre" style="height:80px;float:right;">
              <img src="img/Logo-IIS.jpg" class="img-responsive" alt="Cinque Terre" style="height:80px;float:right">
            </ui>


      </header>

      <section id=" content">
          <section class="wrapper">
              <!--overview start-->
			  <div class="row">
				<div class="col-lg-12">
					<h3 class="page-header" id="sitelocation"><i class="fa fa-laptop"></i>觀測站</h3>
					<ol class="breadcrumb">
						<li><i class="fa fa-home"></i><a href="index.html">Home</a></li>
						<li><i class="fa fa-laptop"></i></li>
            <li><h1>2b</h1></li>
					</ol>
				</div>
			</div>

            <div class="row">
				<div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
					<div class="info-box lass-blue-bg">
						<div class="circle" id="box-1K">--.-</div>
						<div class="title"><h4>自身周圍1公里溫度</h4></div>
					</div><!--/.info-box-->
				</div><!--/.col-->

				<div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
					<div class="info-box lass-blue-bg">
						<div class="circle" id="box-10M">--.-</div>
						<div class="title"><h4>自身周圍10公尺溫度</h4></div>
					</div><!--/.info-box-->
				</div><!--/.col-->

				<div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
					<div class="info-box lass-blue-bg">
						<div class="circle" id="box-AVR">--.-</div>
						<div class="title"><h4>全省即時平均溫度</h4></div>
					</div><!--/.info-box-->
				</div><!--/.col-->

				<div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
					<div class="info-box lass-blue-bg">
						<div class="circle" id="box-HIGHEST">--.-</div>
						<div class="title"><h4>全省測站即時最高溫</h4></div>
					</div><!--/.info-box-->
				</div><!--/.col-->

			</div><!--/.row-->


           <div class="row">
    		    <div class="col-lg-9 col-md-12">

    					<div class="panel panel-default">
    						<div class="panel-heading">
    							<h2><i class="fa fa-map-marker red"></i><strong>WBGT熱點地圖模組</strong></h2>
    							<div class="panel-actions">
    								<!-- <a href="index.html#" class="btn-setting"><i class="fa fa-rotate-right"></i></a>
    								<a href="index.html#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
    								<a href="index.html#" class="btn-close"><i class="fa fa-times"></i></a> -->
    							</div>
    						</div>
    						<div class="panel-body-map" id="map-container">
    							<div id="map" style="height:380px;"></div>
    						</div>

    					</div>
    				</div>
              <div class="col-lg-3 col-md-12">

                					<div class="panel panel-default">
                						<div class="panel-heading">
                							<h2><i class="fa fa-map-marker red"></i><strong>WBGT溫度顏色定義說明模組</strong></h2>
                							<div class="panel-actions">
                								<!-- <a href="index.html#" class="btn-setting"><i class="fa fa-rotate-right"></i></a>
                								<a href="index.html#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
                								<a href="index.html#" class="btn-close"><i class="fa fa-times"></i></a> -->
                							</div>
                						</div>
                						<div class="panel-body" style="height=380px;">
                              <pre>
                              LaborWBGT 溫度顏色定義


                              36.1°C ~ 40°C 紫色, 淺色漸層至深色


                              32.1°C ~ 36°C 紅色, 淺色漸層至深色


                              24.1°C ~ 32°C 棕色, 淺色漸層至深色


                              11.1°C ~ 24°C 綠色, 深色漸層至淺色


                                -1°C ~ 11°C 藍色, 深色漸層至淺色
                              </pre>
                             </div>
                              </div>
                						</div>

                					</div>

		  <!-- Today status end -->



            			<div class="row">

            				<div class="col-lg-9 col-md-12">
            					<div class="panel panel-default">
            						<div class="panel-heading">
            							<h2><i class="fa fa-flag-o red"></i><strong>即時勞工感測器感應數值曲線圖模組</strong></h2>
            							<div class="panel-actions">
            								<!-- <a href="index.html#" class="btn-setting"><i class="fa fa-rotate-right"></i></a>
            								<a href="index.html#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
            								<a href="index.html#" class="btn-close"><i class="fa fa-times"></i></a> -->
            							</div>
            						</div>
            						<div class="panel-body">
                          <!-- Nav tabs -->
                          <ul class="nav nav-tabs" role="tablist">
                            <li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">重力三軸感測器</a></li>
                            <li role="presentation"><a href="#accelerate" aria-controls="accelerate" role="tab" data-toggle="tab">加速度感測器</a></li>
                            <li role="presentation"><a href="#gyro" aria-controls="gyro" role="tab" data-toggle="tab">陀螺儀</a></li>
                          </ul>

                          <div class="tab-content">
                            <div role="tabpanel" class="tab-pane fade in active" id="home">
                              <div id="chartdiv"></div>
                            </div>
                            <div role="tabpanel" class="tab-pane fade" id="accelerate">
                              <div id="chart2div"></div>

                            </div>
                            <div role="tabpanel" class="tab-pane fade" id="gyro">
                              <div id="chart3div"></div>

                            </div>

                          </div>

            						</div>

            					</div>

            				</div><!--/col-->
            				<div class="col-lg-3 col-md-12">
                      <div class="row">
                        <div class="panel panel-default">
              						<div class="panel-heading">
              							<h2><i class="fa fa-map-marker red"></i><strong>即時勞工工作模式分析模組</strong></h2>
              							<div class="panel-actions">
              								<!-- <a href="index.html#" class="btn-setting"><i class="fa fa-rotate-right"></i></a>
              								<a href="index.html#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
              								<a href="index.html#" class="btn-close"><i class="fa fa-times"></i></a> -->
              							</div>
              						</div>
              						<div class="panel-body">
                            <div id="labor_active" style="height:340px">

                            </div>
              						</div>
              					</div>
                      </div>
                    </div>

                  </div>

                  <div class="row">
                    <div class="col-lg-12 col-md-12">
                      <div class="panel panel-default">
                        <div class="panel-heading">
                          <h2><i class="fa fa-flag-o red"></i><strong>即時勞工熱危害與預警建議模組</strong></h2>
                          <div class="panel-actions">
                            <!-- <a href="index.html#" class="btn-setting"><i class="fa fa-rotate-right"></i></a>
                            <a href="index.html#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
                            <a href="index.html#" class="btn-close"><i class="fa fa-times"></i></a> -->
                          </div>
                        </div>
                        <div class="panel-body" style="height:150px">
                          <!-- Nav tabs -->
                        </div>

                      </div>

                    </div><!--/col-->

                  </div>
                <!-- statics end -->
<!-- unused -->
                  <div class="widget-foot">
                    <!-- Footer goes here -->
                  </div>
                </div>
              </div>

            </div>

          </div>
              <!-- project team & activity end -->

          </section>
      </section>
      <!--main content end-->
  </section>
  <!-- container section start -->

  <!-- javascripts -->
  <script src="js/jquery.js"></script>
	<script src="js/jquery-ui-1.10.4.min.js"></script>
  <script src="js/jquery-1.8.3.min.js"></script>
  <script type="text/javascript" src="js/jquery-ui-1.9.2.custom.min.js"></script>
  <!-- bootstrap -->
  <script src="js/bootstrap.min.js"></script>
  <!-- nice scroll -->
  <script src="js/jquery.scrollTo.min.js"></script>
  <script src="js/jquery.nicescroll.js" type="text/javascript"></script>
  <!-- charts scripts -->
  <script src="assets/jquery-knob/js/jquery.knob.js"></script>
  <script src="js/jquery.sparkline.js" type="text/javascript"></script>
  <script src="assets/jquery-easy-pie-chart/jquery.easy-pie-chart.js"></script>
  <script src="js/owl.carousel.js" ></script>
  <!-- jQuery full calendar -->
  <script src="js/fullcalendar.min.js"></script> <!-- Full Google Calendar - Calendar -->
	<script src="assets/fullcalendar/fullcalendar/fullcalendar.js"></script>
  <!--script for this page only-->
  <script src="js/calendar-custom.js"></script>
	<script src="js/jquery.rateit.min.js"></script>
  <!-- custom select -->
  <script src="js/jquery.customSelect.min.js" ></script>
	<script src="assets/chart-master/Chart.js"></script>

  <!--custome script for all page-->
  <script src="js/scripts.js"></script>
  <script src="js/config.js"></script>

  <!-- custom script for this page-->
  <script src="js/sparkline-chart.js"></script>
  <script src="js/easy-pie-chart.js"></script>
	<!-- <script src="js/jquery-jvectormap-1.2.2.min.js"></script>
	<script src="js/jquery-jvectormap-world-mill-en.js"></script> -->
	<script src="js/xcharts.min.js"></script>
	<script src="js/jquery.autosize.min.js"></script>
	<script src="js/jquery.placeholder.min.js"></script>
	<script src="js/gdp-data.js"></script>
	<script src="js/morris.min.js"></script>
	<script src="js/sparklines.js"></script>
	<script src="js/charts.js"></script>
	<script src="js/jquery.slimscroll.min.js"></script>

  <!-- leaflet map -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.5/leaflet.js"></script>
  <script src="https://www.mapquestapi.com//leaflet/v2.s/mq-map.js?key=yUoKtz9vSoTTALff0okCUguWuoxcZTh9"></script>
  <script src="http://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js"></script>
  <script src="http://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.24.0/L.Control.Locate.js"></script>
  <script src="assets/leaflet-groupedlayercontrol/leaflet.groupedlayercontrol.js"></script>
  <script src="js/easy-button.js"></script>
  <!-- <script src="http://leaflet.github.io/Leaflet.heat/dist/leaflet-heat.js"></script>
  <script src="http://leaflet.github.io/Leaflet.markercluster/example/realworld.10000.js"></script> -->



  <script src="http://www.amcharts.com/lib/3/amcharts.js"></script>
  <script src="http://www.amcharts.com/lib/3/serial.js"></script>
  <script src="http://www.amcharts.com/lib/3/themes/light.js"></script>
  <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>

  <script>
      //knob
      $(function() {
        $(".knob").knob({
          'draw' : function () {
            $(this.i).val(this.cv + '%')
          }
        })
      });

      //carousel
      $(document).ready(function() {
          $("#owl-slider").owlCarousel({
              navigation : true,
              slideSpeed : 300,
              paginationSpeed : 400,
              singleItem : true

          });
      });

      //custom select box

      $(function(){
          $('select.styled').customSelect();
      });

  $(function(){
    var markerMap = {};
    var map;
    /* Basemap Layers */
    var mapquestOSM = L.tileLayer("http://a.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      subdomains: ["otile1", "otile2", "otile3", "otile4"],
      attribution: 'Tiles courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png">. Map data (c) <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> contributors, CC-BY-SA.'
    });

    /* Single marker cluster layer to hold all clusters */
    var markerClusters = new L.MarkerClusterGroup({
      spiderfyOnMaxZoom: true,
      showCoverageOnHover: false,
      zoomToBoundsOnClick: true,
      disableClusterinAtZoom: 8
    });


    map = L.map("map", {
      zoom: 8,
      center: [25.0391667, 121.525],
      layers: [mapquestOSM, markerClusters],
      zoomControl: true,
      attributionControl: false
    });

    // Setup map width
    $('#map').width($('.panel-body-map').width());

    $.getJSON(baseURL + "/api/geojsonTI", function(data) {
      var listTable;
      var siteMenu = "";
      var geojson = L.geoJson(data, {
        onEachFeature: function (feature, layer) {

          var wbgto_max = feature.properties.wbgto_max.toFixed(1);
          content = "<table class='table table-striped table-bordered table-condensed'>"
            + "<tr><th>測站名稱</th><td>" + feature.properties.SiteName + "監測站"
            + "</td></tr>" + "<tr><th>縣市</th><td>" + feature.properties.County
            + "</td></tr>" + "<tr><th>狀態</th><td>" + feature.properties.Status
            + "</td></tr>" + "<tr><th>溫度(WBGT)</th><td>" + wbgto_max
            + "</td></tr>" + "<tr><th>濕度</th><td>" + feature.properties.RH.toFixed(1)
            + "</td></tr>" + "<tr><th>資料更新時間</th><td>" + feature.properties.PublishTime
            + "</td></tr>" + "<tr><th>地址</th><td>" + feature.properties.SiteAddres
            + "</td></tr>" + "<table>";
          listTable += "<tr><td>"
            + "<img src=\"img/Taiwan.png\" style=\"height:18px; margin-top:-2px;\"></td>"
            + "<td>" + feature.properties.SiteName + "</td>"
            + "<td>" + feature.properties.PM10 + "</td>"
            + "<td>" + feature.properties['PM2.5'] + "</td>"
            + "<td><div class=\"progress thin\">"
            +  "<div class=\"progress-bar progress-bar-danger\""
            +  " role=\"progressbar\" aria-valuenow=\""+ feature.properties.PSI
            + "\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: "
            + feature.properties.PSI + "% \"></div>"
            + "<div class=\"progress-bar progress-bar-info\""
            + " role=\"progressbar\" aria-valuenow=\""
            + (100 - feature.properties.PSI) + "\" aria-valuemin=\"0\""
            + " aria-valuemax=\"100\" style=\"width: "
            + (100-feature.properties.PSI) + "%\"></div></div>"
            + "<span class=\"sr-only\">" + feature.properties.PSI + "</span>"
            + "</td></tr>";
          siteMenu += "<li><a class=\"\" href=\"chart-chartjs.html?site="
            + feature.properties.SiteName + "\">"
            + feature.properties.SiteName + "</a></li>";
          layer.bindPopup(content);

          // Click event
          layer.on('click', function (e) {
          });
        }
      });
      map.on('locationfound', function (e) {
        var radius = e.accuracy / 2;
        var myLocationIcon = new L.icon({iconUrl: 'img/currentLoc.png',iconAnchor:[14, 38]});

        //Button: Back to current
        L.easyButton('fa-user', function(btn, map){
          L.marker(e.latlng).addTo(map).bindPopup("You are within " + radius + " meters from this point").openPopup();
          L.circle(e.latlng, radius).addTo(map);
          map.panTo(new L.LatLng(e.latlng.lat,e.latlng.lng));
        }).addTo(map);

			  L.marker(e.latlng, {icon: myLocationIcon}).addTo(map)
				    .bindPopup("You are within " + radius + " meters from this point").openPopup();
			  L.circle(e.latlng, radius).addTo(map);
        $.getJSON(baseURL + "/api/geojsonAQI", function(data) {
          var nearbySiteName, nearby1K, nearby10M ,nearbyTmp,averageTmp=0, highestTmp=0, d=300000 ,d_10m=10,count=0;
          var geojson = L.geoJson(data, {
            onEachFeature: function (feature, layer) {
                var slatlng = L.latLng(feature.geometry.coordinates[1],feature.geometry.coordinates[0]);
                //find nearest point
                if(slatlng.distanceTo(e.latlng) < d){
                  nearbySiteName = feature.properties.SiteName;
                  nearbyTmp = feature.properties.wbgto_max.toFixed(1);
                  d = slatlng.distanceTo(e.latlng);
                }
                if(slatlng.distanceTo(e.latlng) < 10  ){
                  nearby10M = feature.properties.wbgto_max.toFixed(1);
                }else{
                  nearby10M = nearbyTmp;
                }
                if(slatlng.distanceTo(e.latlng) < 1000 && (slatlng.distanceTo(e.latlng) > 10)){
                  nearby1K = feature.properties.wbgto_max.toFixed(1);
                }else{
                  nearby1K = nearbyTmp;
                }
                if(feature.properties.wbgto_max.toFixed(1) > 0){
                  averageTmp = (averageTmp+feature.properties.wbgto_max);
                  count=count+1;
                }
                if( highestTmp <  feature.properties.wbgto_max){
                  highestTmp  = feature.properties.wbgto_max.toFixed(1);
                }
            }
          });
          averageTmp = (averageTmp/count);

          $('#sitelocation').html("<i class=\"fa fa-laptop\"></i> 觀測站："+nearbySiteName);
          $("#box-1K").html(nearby1K);

          if((parseFloat(nearby1K)<26.6)){
            $("#box-1K").css("background-color","#ffffff");
          } else if ((parseFloat(nearby1K)>26.7) && (parseFloat(nearby1K)<29.3)) {
            $("#box-1K").css("background-color","#52ff63");
          } else if ((parseFloat(nearby1K)>29.4) && (parseFloat(nearby1K)<31.0)) {
            $("#box-1K").css("background-color","rgb(255, 255, 0)");
          } else if ((parseFloat(nearby1K)>31.1) && (parseFloat(nearby1K)<32.1)) {
            $("#box-1K").css("background-color","rgb(255, 0, 0)");
          } else if (parseFloat(nearby1K)>32.2) {
            $("#box-1K").css("background-color","#000000");
          }
          $("#box-10M").html(nearby10M);
          if((parseFloat(nearby10M)>51) && (parseFloat(nearby10M)<150)){
            $("#box-PM10").css("background-color","#ffd600");
          } else if ((parseFloat(nearby10M)>151) && (parseFloat(nearby10M)<350)) {
            $("#box-PM10").css("background-color","#ff5252");
          } else if ((parseFloat(nearby10M)>351) && (parseFloat(nearby10M)<420)) {
            $("#box-PM10").css("background-color","#795548");
          } else if (parseFloat(nearby10M)>421) {
            $("#box-PM10").css("background-color","#673ab7");
          }
          $("#box-AVR").html(averageTmp.toFixed(1));
          if((parseFloat(averageTmp)>36) && (parseFloat(averageTmp)<53)){
            $("#box-PM25").css("background-color","#ffd600");
          } else if ((parseFloat(averageTmp)>54) && (parseFloat(averageTmp)<64)) {
            $("#box-PM25").css("background-color","#ff5252");
          } else if ((parseFloat(averageTmp)>65) && (parseFloat(averageTmp)<70)) {
            $("#box-PM25").css("background-color","#795548");
          } else if (parseFloat(averageTmp)>71) {
            $("#box-PM25").css("background-color","#673ab7");
          }
          $("#box-HIGHEST").html(highestTmp);
          if((parseFloat(highestTmp)>26.7) && (parseFloat(highestTmp)<29.3)){
            $("#box-WBGT").css("background-color","#ffd600");
          } else if ((parseFloat(highestTmp)>29.4) && (parseFloat(highestTmp)<31.0)) {
            $("#box-WBGT").css("background-color","#ff5252");
          } else if ((parseFloat(highestTmp)>31.1) && (parseFloat(highestTmp)<32.1)) {
            $("#box-WBGT").css("background-color","#795548");
          } else if (parseFloat(highestTmp)>32.2) {
            $("#box-WBGT").css("background-color","#673ab7");
          }

        });
      });

      map.on('locationerror', function(e){
        alert("Sorry, We can not get your current loaction.");
      });
      geojson.addTo(map);
      $('#observeStationList').html(listTable);
      $('#siteMenu').html(siteMenu);
      map.locate({setView: true, maxZoom: 16});

      //Event: Responsive map
      $(window).on('orientationchange pageshow resize', function () {
        $("#map").width($("#map-container").width());
        map.invalidateSize();

      }).trigger('resize');

    });

});


var chartData = []; //will be updated by our simulated server
var chartData2 = [];
var chartData3 = [];

var chart = AmCharts.makeChart("chartdiv", {
  "type": "serial",
  "theme": "light",
  "dataDateFormat": "HH:NN:SS",
  "legend": {
      "useGraphSettings": true
  },
  "valueAxes": [{
    "id": "v1",
    "position": "left"
  },{
    "id": "v2",
    "position": "left",
    "axisColor": ""
  },{
    "id": "v3",
    "position": "left",
    "axisColor": "#FCD202"
  },],

  "graphs": [{
    "id": "g1",
    "bullet": "triangleUp",
    "title": "X軸 重力感測器",
    "valueField": "valueGX",
    "balloonText": "[[category]]: [[valueGX]]",
    "type": "smoothedLine"
  },{
    "id": "g2",
    "bullet": "square",
    "title": "Y軸 重力感測器",
    "valueField": "valueGY",
    "type": "smoothedLine",
    "balloonText": "[[category]]: [[valueGY]]"
  },{
    "id": "g3",
    "bullet": "round",
    "lineColor": "#FF6600",
    "title": "Ｚ軸 重力感測器",
    "valueField": "valueGZ",
    "type": "smoothedLine",
    "balloonText": "[[category]]: [[valueGZ]]"
  }],
  "categoryField": "date",
  "categoryAxis": {
    "parseDates": false,
    "equalSpacing": true,
    "dashLength": 10,
    "minorGridEnabled": true
  },
  // "startDate" :
  "synchronizeGrid":true,
  "dataProvider": chartData
});
var chart2 = AmCharts.makeChart("chart2div", {
  "type": "serial",
  "theme": "light",
  "dataDateFormat": "HH:NN:SS",
  "legend": {
      "useGraphSettings": true
  },
  "valueAxes": [{
    "id": "v1",
    "position": "left"
  },{
    "id": "v2",
    "position": "left",
    "axisColor": ""
  },{
    "id": "v3",
    "position": "left",
    "axisColor": "#FCD202"
  },],

  "graphs": [{
    "id": "g1",
    "bullet": "triangleUp",
    "title": "X軸 加速度感測器",
    "valueField": "valueAX",
    "type": "smoothedLine",
    "balloonText": "[[category]]: [[valueAX]]"
  },{
    "id": "g2",
    "bullet": "square",
    "title": "Y軸 加速度感測器",
    "valueField": "valueAY",
    "type": "smoothedLine",
    "balloonText": "[[category]]: [[valueAY]]"
  },{
    "id": "g3",
    "bullet": "round",
    "lineColor": "#FF6600",
    "title": "Ｚ軸 加速度感測器",
    "valueField": "valueAZ",
    "type": "smoothedLine",
    "balloonText": "[[category]]: [[valueAZ]]"
  }],
  "categoryField": "date",
  "categoryAxis": {
    "parseDates": false,
    "equalSpacing": true,
    "dashLength": 10,
    "minorGridEnabled": true,
  //   "dateFormats": [{
  //       period: 'DD',
  //       format: 'DD'
  //   }, {
  //       period: 'WW',
  //       format: 'MMM DD'
  //   }, {
  //       period: 'MM',
  //       format: 'MMM DD SS'
  //   }, {
  //       period: 'YYYY',
  //       format: 'YYYY'
  //   }]
  //
  },
  // "startDate" :
  "synchronizeGrid":true,
  "dataProvider": chartData
});
var chart3 = AmCharts.makeChart("chart3div", {
  "type": "serial",
  "theme": "light",
  "dataDateFormat": "HH:NN:SS",
  "legend": {
      "useGraphSettings": true
  },
  "valueAxes": [{
    "id": "v1",
    "position": "left"
  },{
    "id": "v2",
    "position": "left",
    "axisColor": ""
  },{
    "id": "v3",
    "position": "left",
    "axisColor": "#FCD202"
  },],

  "graphs": [{
    "id": "g1",
    "bullet": "triangleUp",
    "title": "X軸 陀螺儀感測器",
    "valueField": "valueGyroX",
    "type": "smoothedLine",
    "balloonText": "[[category]]: [[valueGX]]"
  },{
    "id": "g2",
    "bullet": "square",
    "title": "Y軸 陀螺儀感測器",
    "valueField": "valueGyroY",
    "type": "smoothedLine",
    "balloonText": "[[category]]: [[valueGY]]"
  },{
    "id": "g3",
    "bullet": "round",
    "lineColor": "#FF6600",
    "title": "Ｚ軸 陀螺儀感測器",
    "valueField": "valueGyroZ",
    "type": "smoothedLine",
    "balloonText": "[[category]]: [[valueGZ]]"
  }],
  "categoryField": "date",
  "categoryAxis": {
    "parseDates": false,
    "equalSpacing": true,
    "dashLength": 10,
    "minorGridEnabled": true,
  },
  // "startDate" :
  "synchronizeGrid":true,
  "dataProvider": chartData
});


/*
 * Called during the onmessage event. Your application will need
 * to parse  your websocket server's response into a data object
 * or array of dataObjects your chart expects
*/



var socket = io.connect(baseURL+":3000");
var a;
var i=0
socket.on('news', function (data) {
  a = data;
  // var newData = data.hello.hello.new_val.dataset.map(p=>({
  //   value:p.GravityX,
  //   // GRAVITY_Y:p.GRAVITY[1],
  //   // GRAVITY_Z:p.GRAVITY[2,
  //   date:p.Time
  // }));
  // var timestamp = 1293683278;
  var mydate = new Date(data.hello.hello.new_val.dataset.Time*1);

  var newDataGravity = [{
    valueGX:data.hello.hello.new_val.dataset.GravityX,
    valueGY:data.hello.hello.new_val.dataset.GravityY,
    valueGZ:data.hello.hello.new_val.dataset.GravityZ,
    valueAX:data.hello.hello.new_val.dataset.AccelerometerX,
    valueAY:data.hello.hello.new_val.dataset.AccelerometerY,
    valueAZ:data.hello.hello.new_val.dataset.AccelerometerZ,
    valueGyroX:data.hello.hello.new_val.dataset.GyroscopeX,
    valueGyroY:data.hello.hello.new_val.dataset.GyroscopeY,
    valueGyroZ:data.hello.hello.new_val.dataset.GyroscopeZ,

    date:mydate.getHours()+":"+mydate.getMinutes()+":"+mydate.getSeconds(),

    }];
  var newDataAccelerate = [{
    valueAY:data.hello.hello.new_val.dataset.AccelerometerY,
    valueAZ:data.hello.hello.new_val.dataset.AccelerometerZ,
    date:mydate.getHours()+":"+mydate.getMinutes()+":"+mydate.getSeconds()
    }];
  var newDataGyro = [{
    valueGyroX:data.hello.hello.new_val.dataset.GyroscopeX,
    valueGyroY:data.hello.hello.new_val.dataset.GyroscopeY,
    valueGyroZ:data.hello.hello.new_val.dataset.GyroscopeZ,
    date:mydate.getHours()+":"+mydate.getMinutes()+":"+mydate.getSeconds()
    }];

  chartData.push.apply(chartData, newDataGravity);
  chartData2.push.apply(chartData2, newDataAccelerate);
  chartData3.push.apply(chartData3, newDataGyro);

  // keep only 50 datapoints on screen for the demo
  if (chartData.length > 10) {
    chartData.splice(0, chartData.length - 10);
  }
  if (chartData2.length > 10) {
    chartData2.splice(0, chartData2.length - 10);
  }
  if (chartData3.length > 10) {
    chartData3.splice(0, chartData3.length - 10);
  }

  // writeToScreen("<span style='color: blue'>Received: " + wsEvent.data + "</span>");
  chart.validateData(); //call to redraw the chart with new data
  chart2.validateData(); //call to redraw the chart with new data
  chart3.validateData(); //call to redraw the chart with new data

  // socket.emit('my other event', { my: 'data' });
});

  </script>

  </body>
</html>
