<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Creative - Bootstrap 3 Responsive Admin Template">
    <meta name="author" content="GeeksLabs">
    <meta name="keyword" content="Creative, Dashboard, Admin, Template, Theme, Bootstrap, Responsive, Retina, Minimal">
    <link rel="shortcut icon" href="img/favicon.png">

    <title>戶外高氣溫作業場所勞動者資訊平台</title>

    <!-- Bootstrap CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- bootstrap theme -->
    <link href="css/bootstrap-theme.css" rel="stylesheet">
    <!--external css-->
    <!-- font icon -->
    <link href="css/elegant-icons-style.css" rel="stylesheet" />
    <link href="css/font-awesome.min.css" rel="stylesheet" />
    <!-- full calendar css-->
    <link href="assets/fullcalendar/fullcalendar/bootstrap-fullcalendar.css" rel="stylesheet" />
	  <link href="assets/fullcalendar/fullcalendar/fullcalendar.css" rel="stylesheet" />
    <!-- easy pie chart-->
    <link href="assets/jquery-easy-pie-chart/jquery.easy-pie-chart.css" rel="stylesheet" type="text/css" media="screen"/>
    <!-- owl carousel -->
    <!-- <link rel="stylesheet" href="css/owl.carousel.css" type="text/css">
	  <link href="css/jquery-jvectormap-1.2.2.css" rel="stylesheet"> -->
    <!-- leaflet map -->
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css">
    <link rel="stylesheet" href="http://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.css">
    <link rel="stylesheet" href="http://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.Default.css">
    <link rel="stylesheet" href="http://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.24.0/L.Control.Locate.css">
    <link rel="stylesheet" href="assets/leaflet-groupedlayercontrol/leaflet.groupedlayercontrol.css">
    <link rel="stylesheet" href="css/easy-button.css">

    <!-- Custom styles -->
	  <link rel="stylesheet" href="css/fullcalendar.css">
	  <link href="css/widgets.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/style-responsive.css" rel="stylesheet" />
	  <link href="css/xcharts.min.css" rel=" stylesheet">
	  <link href="css/jquery-ui-1.10.4.min.css" rel="stylesheet">
    <style >
    #chartdiv {
    width: 100%;
    height: 300px;
  }
  #chart2div {
    width: 100%;
    height: 300px;
  }
  #chart3div {
    width: 100%;
    height: 300px;
  }

    </style>

  </head>

  <body>
  <!-- container section start -->
  <section id="container" class="">


      <header class="header dark-bg navbar navbar-default">
            <div class="toggle-nav">
                <div class="icon-reorder tooltips" data-original-title="Toggle Navigation" data-placement="bottom"></div>
            </div>

            <!--logo start-->
            <a href="index.html" class="logo">勞動部 <span class="lite">戶外高氣溫作業場所勞動者資訊平台</span></a>
            <!--logo end-->

            <ui class="nav navbar-nav navbar-right" >
              <img src="img/Logo-MOL.jpg" class="img-responsive" alt="Cinque Terre" style="height:80px;float:right;margin-right: -15px;">
              <img src="img/Logo-RCEC.jpg" class="img-responsive" alt="Cinque Terre" style="height:80px;float:right;">
              <img src="img/Logo-IIS.jpg" class="img-responsive" alt="Cinque Terre" style="height:80px;float:right">
            </ui>


      </header>

      <section id=" content">
          <section class="wrapper">
              <!--overview start-->
			  <div class="row">
				<div class="col-lg-12">
					<h3 class="page-header" id="sitelocation"><i class="fa fa-laptop"></i>觀測站</h3>
            <h4><i class="fa fa-map-marker red"></i><strong>  WBGT溫度分析</strong></h4>
				</div>
			</div>

            <div class="row">
				<div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
					<div class="info-box lass-blue-bg">
						<div class="circle" id="box-1K">--.-</div>
            <div>
              <div class="title" style="font-size:150%;font-weight:300" id="domIdNearBy1K">
                自身周圍1公里
                <br>
                WBGT模組
              </div>
            </div>
					</div><!--/.info-box-->
				</div><!--/.col-->

				<div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
					<div class="info-box lass-blue-bg">
						<div class="circle" id="box-10M">--.-</div>
            <div>
              <div class="title" style="font-size:150%;font-weight:300" id="domIdNearBy10M">
                自身周圍10公尺
                <br>
                WBGT模組
              </div>
            </div>

					</div><!--/.info-box-->
				</div><!--/.col-->

				<div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
					<div class="info-box lass-blue-bg">
						<div class="circle" id="box-AVR">--.-</div>
            <div>
              <div class="title" style="font-size:150%;font-weight:300">
                全國即時平均
                <br>
                WBGT模組
              </div>
            </div>
					</div><!--/.info-box-->
				</div><!--/.col-->

				<div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
					<div class="info-box lass-blue-bg">
						<div class="circle" id="box-HIGHEST">--.-</div>
            <div>
              <div class="title" style="font-size:150%;font-weight:300">
                全國即時最高
                <br>
                WBGT模組
              </div>
            </div>
					</div><!--/.info-box-->
				</div><!--/.col-->

			</div><!--/.row-->


           <div class="row">
    		    <div class="col-lg-12 col-md-12">

    					<div class="panel panel-default">
    						<div class="panel-heading">
    							<h4><i class="fa fa-map-marker red"></i><strong>WBGT熱點地圖模組</strong></h4>
    							<div class="panel-actions">
    								<!-- <a href="index.html#" class="btn-setting"><i class="fa fa-rotate-right"></i></a>
    								<a href="index.html#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
    								<a href="index.html#" class="btn-close"><i class="fa fa-times"></i></a> -->
    							</div>
    						</div>
    						<div class="panel-body-map" id="map-container">
    							<div id="map" style="height:380px;"></div>
    						</div>

    					</div>
    				</div>
              <!-- <div class="col-lg-3 col-md-12">

                					<div class="panel panel-default">
                						<div class="panel-heading">
                							<h2><i class="fa fa-map-marker red"></i><strong>WBGT溫度顏色定義模組</strong></h2>
                							<div class="panel-actions">
                								<!-- <a href="index.html#" class="btn-setting"><i class="fa fa-rotate-right"></i></a>
                								<a href="index.html#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
                								<a href="index.html#" class="btn-close"><i class="fa fa-times"></i></a> -->
                							</div>
                						</div>
                						<!-- <div class="panel-body" style="height:380px;">
                              <h1  class="text-center" style="color:#ffd600">溫度顏色定義</h1>

                                <p class="text-center">白色 <= 26.6</p>
                                <br>
                                <p class="text-center">綠色 26.7 - 29.3</p> -->
<!-- <br>
                                <p class="text-center">黃色 29.4 - 31.0</p>
<br>
                                <p class="text-center">紅色 31.1 - 32.1</p>
<br>
                                <p class="text-center">黑色 >= 32.2</p>
                             </div>
                              </div>
                						</div> -->

                					<!-- </div> -->

		  <!-- Today status end -->



            			<div class="row">

            				<div class="col-lg-9 col-md-12">
            					<div class="panel panel-default">
            						<div class="panel-heading">
            							<h2><i class="fa fa-flag-o red"></i><strong>即時勞工感測器感應數值曲線圖模組</strong></h2>
            							<div class="panel-actions">
            								<!-- <a href="index.html#" class="btn-setting"><i class="fa fa-rotate-right"></i></a>
            								<a href="index.html#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
            								<a href="index.html#" class="btn-close"><i class="fa fa-times"></i></a> -->
            							</div>
            						</div>
            						<div class="panel-body">
                          <!-- Nav tabs -->
                          <ul class="nav nav-tabs" role="tablist">
                            <li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">重力三軸感測器</a></li>
                            <li role="presentation"><a href="#accelerate" aria-controls="accelerate" role="tab" data-toggle="tab">加速度感測器</a></li>
                            <li role="presentation"><a href="#gyro" aria-controls="gyro" role="tab" data-toggle="tab">陀螺儀</a></li>
                          </ul>

                          <div class="tab-content">
                            <div role="tabpanel" class="tab-pane fade in active" id="home">
                              <div id="chartdiv"></div>
                            </div>
                            <div role="tabpanel" class="tab-pane fade" id="accelerate">
                              <div id="chart2div"></div>

                            </div>
                            <div role="tabpanel" class="tab-pane fade" id="gyro">
                              <div id="chart3div"></div>

                            </div>

                          </div>

            						</div>

            					</div>

            				</div><!--/col-->
            				<div class="col-lg-3 col-md-12">
                      <div class="row">
                        <div class="panel panel-default">
              						<div class="panel-heading">
              							<h2><i class="fa fa-map-marker red"></i><strong>即時勞工工作模式分析模組</strong></h2>
              							<div class="panel-actions">
              								<!-- <a href="index.html#" class="btn-setting"><i class="fa fa-rotate-right"></i></a>
              								<a href="index.html#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
              								<a href="index.html#" class="btn-close"><i class="fa fa-times"></i></a> -->
              							</div>
              						</div>
              						<div class="panel-body">
                            <div id="labor_active" style="height:340px">

                              <!-- Nav tabs -->
                              <ul class="nav nav-tabs" role="tablist">
                                <li role="presentation" class="active"><a href="#active_light" aria-controls="active_light" role="tab" data-toggle="tab">輕度工作</a></li>
                                <li role="presentation"><a href="#active_moderate" aria-controls="active_moderate" role="tab" data-toggle="tab">中度工作</a></li>
                                <li role="presentation"><a href="#active_heavy" aria-controls="active_heavy" role="tab" data-toggle="tab">重度工作</a></li>
                              </ul>

                              <!-- Tab panes -->
                              <div class="tab-content">
                                <div role="tabpanel" class="tab-pane active" id="active_light">
                                  <h1  class="text-center">輕度工作</h1>
                                  <h1  class="text-center"><small class="text-center">分析結果</small></h1>
                                  <blockquote>
                                    <p>坐姿進行手臂部動作以操縱機器、立姿進行手臂部動作以操縱機器者</p>
                                    <!-- <footer>Someone famous in <cite title="Source Title">Source Title</cite></footer> -->
                                  </blockquote>
                                </div>

                                <div role="tabpanel" class="tab-pane" id="active_moderate">
                                  <h1  class="text-center">中度工作</h1>
                                  <h1  class="text-center"><small class="text-center">分析結果</small></h1>
                                  <blockquote>
                                    <p>走動中提舉一般重量物體、推動一般重量物體</p>
                                    <!-- <footer>Someone famous in <cite title="Source Title">Source Title</cite></footer> -->
                                  </blockquote>
                                </div>
                                <div role="tabpanel" class="tab-pane" id="active_heavy">
                                  <h1  class="text-center">重度工作</h1>
                                  <h1  class="text-center"><small class="text-center">分析結果</small></h1>
                                  <blockquote>
                                    <p>鏟之全身運動、掘之全身運動、推之全身運動</p>
                                    <!-- <footer>Someone famous in <cite title="Source Title">Source Title</cite></footer> -->
                                  </blockquote>
                                </div>
                              </div>

                            </div>
              						</div>
              					</div>
                      </div>
                    </div>

                  </div>

                  <div class="row">
                    <div class="col-lg-12 col-md-12">
                      <div class="panel panel-default">
                        <div class="panel-heading">
                          <h2><i class="fa fa-flag-o red"></i><strong>即時勞工熱危害與預警建議模組</strong></h2>
                          <div class="panel-actions">
                            <!-- <a href="index.html#" class="btn-setting"><i class="fa fa-rotate-right"></i></a>
                            <a href="index.html#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
                            <a href="index.html#" class="btn-close"><i class="fa fa-times"></i></a> -->
                          </div>
                        </div>
                        <div class="panel-body" style="height:400px">
                          <!-- Nav tabs -->

                          <!-- Nav tabs -->
                          <ul class="nav nav-tabs" role="tablist">
                            <li role="presentation" class="active"><a href="#alert_green" aria-controls="alert_green" role="tab" data-toggle="tab">綠色等級</a></li>
                            <li role="presentation"><a href="#alert_yellow" aria-controls="alert_yellow" role="tab" data-toggle="tab">黃色等級</a></li>
                            <li role="presentation"><a href="#alert_orange" aria-controls="alert_orange" role="tab" data-toggle="tab">橘色等級</a></li>
                            <li role="presentation"><a href="#alert_red" aria-controls="alert_red" role="tab" data-toggle="tab">紅色等級</a></li>
                          </ul>

                          <!-- Tab panes -->
                          <div class="tab-content">
                            <div role="tabpanel" class="tab-pane active" id="alert_green">
                              <h1  class="text-center" style="color:#37d747">綠色等級</h1>
                              <h1  class="text-center"><small class="text-center">分析結果</small></h1>
                              <blockquote>
                                <p class="text-center">您目前遭受的熱危害等級，屬於：綠色等級</p>
                                <div class="text-center">
                                  <ol>
                                      <p>當環境溫度低於人體體溫時，可利用電風扇增加空氣流動速度，以加速帶走人體或熱源之熱量，達到降低溫度的目的</p>
                                      <p >當環境溫度高於人體皮膚溫度時，則不應使用電風扇，應以工廠製程的改善或使用防護設備為主。</p>
                                      <p>在粉塵或灰塵較多的工作場所中，過大的風速可能會造成揚塵，不建議使用電風扇。</p>
                                  </ol>
                                </div>
                                  <p class="text-center">※患有高血壓、心臟病、肝疾病、消化性潰瘍、內分泌失調、無汗症及腎疾病等症狀者，均不適宜從事熱環境作業。
                                  </p>
                                <!-- <footer>Someone famous in <cite title="Source Title">Source Title</cite></footer> -->
                              </blockquote>
                            </div>
                            <div role="tabpanel" class="tab-pane" id="alert_yellow">
                              <div class="col-lg-2 col-md-12"></div>
                              <div class="col-lg-8 col-md-12">
                                <h1  class="text-center" style="color:#ffd600">黃色等級</h1>
                                <h1  class="text-center"><small class="text-center">分析結果</small></h1>
                                <blockquote>
                                  <p class="text-center">您目前遭受的熱危害等級，屬於：黃色等級</p>
                                  <div>
                                    <ol>
                                        <p>1. 一般環境工作者而言，不論工作者從事輕或重體力工作負荷，建議選擇透氣、吸汗的材質，將增加散熱及減少熱蓄積。</p>
                                        <p>2.應補充適量含水分（必要時得添加食鹽或是飲用運動飲料），以減少熱疾病發生的機率。</p>
                                        <p>3. 熱作業工作者（例如瀝青作業等含有熱源之作業），若需求必須穿著較厚重、熱阻值較高的衣物，以防止熱量進入人體，但相對的此時工作者的體熱亦不容易排出體外，因此若不加注意、或工作時間過長，則很容易造成熱蓄積或引發”熱疾病”。</p>
                                    </ol>
                                  </div>
                                  <br>
                                    <p class="text-center">※患有高血壓、心臟病、肝疾病、消化性潰瘍、內分泌失調、無汗症及腎疾病等症狀者，均不適宜從事熱環境作業。
                                    </p>
                                  <!-- <footer>Someone famous in <cite title="Source Title">Source Title</cite></footer> -->
                                </blockquote>
                              </div>
                              <div class="col-lg-2 col-md-12"></div>
                            </div>
                            <div role="tabpanel" class="tab-pane" id="alert_orange">
                              <h1  class="text-center" style="color:#ffba33">橘色等級</h1>
                              <h1  class="text-center"><small class="text-center">分析結果</small></h1>
                              <blockquote>
                                <p class="text-center">您目前遭受的熱危害等級，屬於：綠色等級</p>
                                <div class="text-center">
                                  <ol>
                                      <p>在此種環境連續工作時需要安排適當的休息時間，亦可利用工作輪替之方式以確保勞工安全。</p>
                                      <p>應補充適量含水分（必要時得添加食鹽或是飲用運動飲料），以減少熱疾病發生的機率。</p>
                                      <p>所補充之水分其水溫不宜太高或太低，約在10℃～15℃之間較為適宜。</p>
                                  </ol>
                                </div>
                                  <p class="text-center">※患有高血壓、心臟病、肝疾病、消化性潰瘍、內分泌失調、無汗症及腎疾病等症狀者，均不適宜從事熱環境作業。
                                  </p>
                                <!-- <footer>Someone famous in <cite title="Source Title">Source Title</cite></footer> -->
                              </blockquote>

                            </div>
                            <div role="tabpanel" class="tab-pane" id="alert_red">
                              <h1  class="text-center" style="color:#ff5252">紅色等級</h1>
                              <h1  class="text-center"><small class="text-center">分析結果</small></h1>
                              <blockquote>
                                <p class="text-center">您目前遭受的熱危害等級，屬於：紅色等級</p>
                                <div class="text-center">
                                  <ol>
                                    <p>建議進行輪班、避開該時段作業，甚至暫停作業。</p>
                                  </ol>
                                </div>
                                  <p class="text-center">※患有高血壓、心臟病、肝疾病、消化性潰瘍、內分泌失調、無汗症及腎疾病等症狀者，均不適宜從事熱環境作業。
                                  </p>
                                <!-- <footer>Someone famous in <cite title="Source Title">Source Title</cite></footer> -->
                              </blockquote>

                            </div>
                          </div>

                        </div>

                      </div>

                    </div><!--/col-->

                  </div>
                <!-- statics end -->
<!-- unused -->
                  <div class="widget-foot">
                    <!-- Footer goes here -->
                  </div>
                </div>
              </div>

            </div>

          </div>
              <!-- project team & activity end -->

          </section>
      </section>
      <!--main content end-->
  </section>
  <!-- container section start -->

  <!-- javascripts -->
  <script src="js/jquery.js"></script>
	<script src="js/jquery-ui-1.10.4.min.js"></script>
  <script src="js/jquery-1.8.3.min.js"></script>
  <script type="text/javascript" src="js/jquery-ui-1.9.2.custom.min.js"></script>
  <!-- bootstrap -->
  <script src="js/bootstrap.min.js"></script>
  <!-- nice scroll -->
  <script src="js/jquery.scrollTo.min.js"></script>
  <script src="js/jquery.nicescroll.js" type="text/javascript"></script>
  <!-- charts scripts -->
  <script src="assets/jquery-knob/js/jquery.knob.js"></script>
  <script src="js/jquery.sparkline.js" type="text/javascript"></script>
  <script src="assets/jquery-easy-pie-chart/jquery.easy-pie-chart.js"></script>
  <script src="js/owl.carousel.js" ></script>
  <!-- jQuery full calendar -->
  <script src="js/fullcalendar.min.js"></script> <!-- Full Google Calendar - Calendar -->
	<script src="assets/fullcalendar/fullcalendar/fullcalendar.js"></script>
  <!--script for this page only-->
  <script src="js/calendar-custom.js"></script>
	<script src="js/jquery.rateit.min.js"></script>
  <!-- custom select -->
  <script src="js/jquery.customSelect.min.js" ></script>
	<script src="assets/chart-master/Chart.js"></script>

  <!--custome script for all page-->
  <script src="js/scripts.js"></script>
  <script src="js/config.js"></script>

  <!-- custom script for this page-->
  <script src="js/sparkline-chart.js"></script>
  <script src="js/easy-pie-chart.js"></script>
	<!-- <script src="js/jquery-jvectormap-1.2.2.min.js"></script>
	<script src="js/jquery-jvectormap-world-mill-en.js"></script> -->
	<script src="js/xcharts.min.js"></script>
	<script src="js/jquery.autosize.min.js"></script>
	<script src="js/jquery.placeholder.min.js"></script>
	<script src="js/gdp-data.js"></script>
	<script src="js/morris.min.js"></script>
	<script src="js/sparklines.js"></script>
	<script src="js/charts.js"></script>
	<script src="js/jquery.slimscroll.min.js"></script>

  <!-- leaflet map -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.5/leaflet.js"></script>
  <script src="https://www.mapquestapi.com//leaflet/v2.s/mq-map.js?key=yUoKtz9vSoTTALff0okCUguWuoxcZTh9"></script>
  <script src="http://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js"></script>
  <script src="http://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.24.0/L.Control.Locate.js"></script>
  <script src="assets/leaflet-groupedlayercontrol/leaflet.groupedlayercontrol.js"></script>
  <script src="js/easy-button.js"></script>
  <!-- <script src="http://leaflet.github.io/Leaflet.heat/dist/leaflet-heat.js"></script>
  <script src="http://leaflet.github.io/Leaflet.markercluster/example/realworld.10000.js"></script> -->



  <script src="http://www.amcharts.com/lib/3/amcharts.js"></script>
  <script src="http://www.amcharts.com/lib/3/serial.js"></script>
  <script src="http://www.amcharts.com/lib/3/themes/light.js"></script>
  <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>

  <script>
      //knob
      var nearby1K, nearby10M;
      $(function() {
        $(".knob").knob({
          'draw' : function () {
            $(this.i).val(this.cv + '%')
          }
        })
      });

      //carousel
      $(document).ready(function() {
          $("#owl-slider").owlCarousel({
              navigation : true,
              slideSpeed : 300,
              paginationSpeed : 400,
              singleItem : true

          });
      });

      //custom select box

      $(function(){
          $('select.styled').customSelect();
      });

  $(function(){
    var markerMap = {};
    var map;
    /* Basemap Layers */
    var mapquestOSM = L.tileLayer("http://a.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      subdomains: ["otile1", "otile2", "otile3", "otile4"],
      attribution: 'Tiles courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png">. Map data (c) <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> contributors, CC-BY-SA.'
    });

    /* Single marker cluster layer to hold all clusters */
    var markerClusters = new L.MarkerClusterGroup({
      spiderfyOnMaxZoom: true,
      showCoverageOnHover: false,
      zoomToBoundsOnClick: true,
      disableClusterinAtZoom: 8
    });


    map = L.map("map", {
      zoom: 8,
      center: [25.0391667, 121.525],
      layers: [mapquestOSM, markerClusters],
      zoomControl: true,
      attributionControl: false
    });

    // Setup map width
    $('#map').width($('.panel-body-map').width());
  var a
    $.getJSON(baseURL + "/api/geojsonTI", function(data) {
      var listTable;
      var siteMenu = "";
      var geojson = L.geoJson(data, {
        onEachFeature: function (feature, layer) {

          var wbgto_max = feature.properties.wbgto_max.toFixed(1);
          content = "<table class='table table-striped table-bordered table-condensed'>"
            + "<tr><th>測站名稱</th><td>" + feature.properties.SiteName + "監測站"
            + "</td></tr>" + "<tr><th>縣市</th><td>" + feature.properties.County
            + "</td></tr>" + "<tr><th>狀態</th><td>" + feature.properties.Status
            + "</td></tr>" + "<tr><th>溫度(WBGT)</th><td>" + wbgto_max
            + "</td></tr>" + "<tr><th>濕度</th><td>" + feature.properties.RH.toFixed(1)
            + "</td></tr>" + "<tr><th>資料更新時間</th><td>" + feature.properties.PublishTime
            + "</td></tr>" + "<tr><th>地址</th><td>" + feature.properties.SiteAddres
            + "</td></tr>" + "<table>";
          layer.bindPopup(content);

          // Click event

          layer.on('click', function (e) {
            console.log("layer:click"+e.target.feature.properties);
            $("#box-1K").html((e.target.feature.properties.wbgto_max).toFixed(1));
            $("#box-10M").html((e.target.feature.properties.wbgto_max).toFixed(1));
            $("#domIdNearBy10M").html("測站周圍10公尺溫度");
            $("#domIdNearBy1K").html("測站周圍1公里溫度");

            a = e;
          });
        }
      });
      map.on('locationfound', function (e) {
        var radius = e.accuracy / 2;
        var myLocationIcon = new L.icon({iconUrl: 'img/currentLoc.png',iconAnchor:[14, 38]});

        //Button: Back to current
        L.easyButton('fa-user', function(btn, map){
          // debugger;
          L.marker(e.latlng).addTo(map).bindPopup("You are within " + radius + " meters from this point").openPopup();
          L.circle(e.latlng, radius).addTo(map);
          map.panTo(new L.LatLng(e.latlng.lat,e.latlng.lng));
          $("#box-1K").html(nearby1K);
          $("#box-10M").html(nearby10M);
          $("#domIdNearBy10M").html("自身周圍10公尺<br>WBGT模組");
          $("#domIdNearBy1K").html("自身周圍1公里<br>WBGT模組");
        }).addTo(map);

			  L.marker(e.latlng, {icon: myLocationIcon}).addTo(map)
				    .bindPopup("You are within " + radius + " meters from this point").openPopup();
			  L.circle(e.latlng, radius).addTo(map);
        $.getJSON(baseURL + "/api/geojsonAQI", function(data) {
          var nearbySiteName ,nearbyTmp,averageTmp=0, highestTmp=0, d=300000 ,d_10m=10,count=0;
          var geojson = L.geoJson(data, {
            onEachFeature: function (feature, layer) {
                var slatlng = L.latLng(feature.geometry.coordinates[1],feature.geometry.coordinates[0]);
                //find nearest point
                if(slatlng.distanceTo(e.latlng) < d){
                  nearbySiteName = feature.properties.SiteName;
                  nearbyTmp = feature.properties.wbgto_max.toFixed(1);
                  d = slatlng.distanceTo(e.latlng);
                }
                if(slatlng.distanceTo(e.latlng) < 10  ){
                  nearby10M = feature.properties.wbgto_max.toFixed(1);
                }else{
                  nearby10M = nearbyTmp;
                }
                if(slatlng.distanceTo(e.latlng) < 1000 && (slatlng.distanceTo(e.latlng) > 10)){
                  nearby1K = feature.properties.wbgto_max.toFixed(1);
                }else{
                  nearby1K = nearbyTmp;
                }
                if(feature.properties.wbgto_max.toFixed(1) > 0){
                  averageTmp = (averageTmp+feature.properties.wbgto_max);
                  count=count+1;
                }
                if( highestTmp <  feature.properties.wbgto_max){
                  highestTmp  = feature.properties.wbgto_max.toFixed(1);
                }
            }
          });
          averageTmp = (averageTmp/count).toFixed();

          $('#sitelocation').html("<i class=\"fa fa-laptop\"></i> 觀測站："+nearbySiteName);
          $("#box-1K").html(nearby1K);

          if((parseFloat(nearby1K)<=26.6)){
            $("#box-1K").css("background-color","#ffffff");
            $("#box-1K").css("color","#000000");

          } else if ((parseFloat(nearby1K)>=26.7) && (parseFloat(nearby1K)<=29.3)) {
            $("#box-1K").css("background-color","#52ff63");
          } else if ((parseFloat(nearby1K)>=29.4) && (parseFloat(nearby1K)<=31.0)) {
            $("#box-1K").css("background-color","#ffd600");
          } else if ((parseFloat(nearby1K)>=31.1) && (parseFloat(nearby1K)<=32.1)) {
            $("#box-1K").css("background-color","#ff5252");
          } else if (parseFloat(nearby1K)>=32.2) {
            $("#box-1K").css("background-color","#000000");
          }

          $("#box-10M").html(nearby10M);
          if((parseFloat(nearby10M)<=26.6)){
            $("#box-10M").css("background-color","#ffffff");
            $("#box-10M").css("color","#000000");

          } else if ((parseFloat(nearby10M)>=26.7) && (parseFloat(nearby10M)<=29.3)) {
            $("#box-10M").css("background-color","#52ff63");
          } else if ((parseFloat(nearby10M)>=29.4) && (parseFloat(nearby10M)<=31.0)) {
            $("#box-10M").css("background-color","#ffd600");
          } else if ((parseFloat(nearby10M)>=31.1) && (parseFloat(nearby10M)<=32.1)) {
            $("#box-10M").css("background-color","#ff5252");
          } else if (parseFloat(nearby10M)>=32.2) {
            $("#box-10M").css("background-color","#000000");
          }

          $("#box-AVR").html(averageTmp);
          if((parseFloat(averageTmp)<=26.6)){
            $("#box-AVR").css("background-color","#ffffff");
            $("#box-AVR").css("color","#000000");

          } else if ((parseFloat(averageTmp)>=26.7) && (parseFloat(averageTmp)<=29.3)) {
            $("#box-AVR").css("background-color","#52ff63");
          } else if ((parseFloat(averageTmp)>=29.4) && (parseFloat(averageTmp)<=31.0)) {
            $("#box-AVR").css("background-color","#ffd600");
          } else if ((parseFloat(averageTmp)>=31.1) && (parseFloat(averageTmp)<=32.1)) {
            $("#box-AVR").css("background-color","#ff5252");
          } else if (parseFloat(averageTmp)>=32.2) {
            $("#box-AVR").css("background-color","#000000");
          }

          $("#box-HIGHEST").html(highestTmp);
          if((parseFloat(highestTmp)<=26.6)){
            $("#box-HIGHEST").css("background-color","#ffffff");
            $("#box-HIGHEST").css("color","#000000");

          } else if ((parseFloat(highestTmp)>=26.7) && (parseFloat(highestTmp)<=29.3)) {
            $("#box-HIGHEST").css("background-color","#52ff63");
          } else if ((parseFloat(highestTmp)>=29.4) && (parseFloat(highestTmp)<=31.0)) {
            $("#box-HIGHEST").css("background-color","#ffd600");
          } else if ((parseFloat(highestTmp)>=31.1) && (parseFloat(highestTmp)<=32.1)) {
            $("#box-HIGHEST").css("background-color","#ff5252");
          } else if (parseFloat(highestTmp)>=32.2) {
            $("#box-HIGHEST").css("background-color","#000000");
          }
        });
      });

      map.on('locationerror', function(e){
        alert("Sorry, We can not get your current loaction.");
      });
      geojson.addTo(map);
      $('#observeStationList').html(listTable);
      $('#siteMenu').html(siteMenu);
      map.locate({setView: true, maxZoom: 16});

      //Event: Responsive map
      $(window).on('orientationchange pageshow resize', function () {
        $("#map").width($("#map-container").width());
        map.invalidateSize();
      }).trigger('resize');

    });

});


var chartData = []; //will be updated by our simulated server
var chartData2 = [];
var chartData3 = [];

var chart = AmCharts.makeChart("chartdiv", {
  "type": "serial",
  "theme": "light",
  "dataDateFormat": "HH:NN:SS",
  "legend": {
      "useGraphSettings": true
  },
  "valueAxes": [{
    "id": "v1",
    "position": "left"
  },{
    "id": "v2",
    "position": "left",
    "axisColor": ""
  },{
    "id": "v3",
    "position": "left",
    "axisColor": "#FCD202"
  },],

  "graphs": [{
    "id": "g1",
    "bullet": "triangleUp",
    "title": "X軸 重力感測器",
    "valueField": "valueGX",
    "balloonText": "[[category]]: [[valueGX]]",
    "type": "smoothedLine"
  },{
    "id": "g2",
    "bullet": "square",
    "title": "Y軸 重力感測器",
    "valueField": "valueGY",
    "type": "smoothedLine",
    "balloonText": "[[category]]: [[valueGY]]"
  },{
    "id": "g3",
    "bullet": "round",
    "lineColor": "#FF6600",
    "title": "Ｚ軸 重力感測器",
    "valueField": "valueGZ",
    "type": "smoothedLine",
    "balloonText": "[[category]]: [[valueGZ]]"
  }],
  "categoryField": "date",
  "categoryAxis": {
    "parseDates": false,
    "equalSpacing": true,
    "dashLength": 10,
    "minorGridEnabled": true
  },
  // "startDate" :
  "synchronizeGrid":true,
  "dataProvider": chartData
});
var chart2 = AmCharts.makeChart("chart2div", {
  "type": "serial",
  "theme": "light",
  "dataDateFormat": "HH:NN:SS",
  "legend": {
      "useGraphSettings": true
  },
  "valueAxes": [{
    "id": "v1",
    "position": "left"
  },{
    "id": "v2",
    "position": "left",
    "axisColor": ""
  },{
    "id": "v3",
    "position": "left",
    "axisColor": "#FCD202"
  },],

  "graphs": [{
    "id": "g1",
    "bullet": "triangleUp",
    "title": "X軸 加速度感測器",
    "valueField": "valueAX",
    "type": "smoothedLine",
    "balloonText": "[[category]]: [[valueAX]]"
  },{
    "id": "g2",
    "bullet": "square",
    "title": "Y軸 加速度感測器",
    "valueField": "valueAY",
    "type": "smoothedLine",
    "balloonText": "[[category]]: [[valueAY]]"
  },{
    "id": "g3",
    "bullet": "round",
    "lineColor": "#FF6600",
    "title": "Ｚ軸 加速度感測器",
    "valueField": "valueAZ",
    "type": "smoothedLine",
    "balloonText": "[[category]]: [[valueAZ]]"
  }],
  "categoryField": "date",
  "categoryAxis": {
    "parseDates": false,
    "equalSpacing": true,
    "dashLength": 10,
    "minorGridEnabled": true,
  },
  "synchronizeGrid":true,
  "dataProvider": chartData
});
var chart3 = AmCharts.makeChart("chart3div", {
  "type": "serial",
  "theme": "light",
  "dataDateFormat": "HH:NN:SS",
  "legend": {
      "useGraphSettings": true
  },
  "valueAxes": [{
    "id": "v1",
    "position": "left"
  },{
    "id": "v2",
    "position": "left",
    "axisColor": ""
  },{
    "id": "v3",
    "position": "left",
    "axisColor": "#FCD202"
  },],

  "graphs": [{
    "id": "g1",
    "bullet": "triangleUp",
    "title": "X軸 陀螺儀感測器",
    "valueField": "valueGyroX",
    "type": "smoothedLine",
    "balloonText": "[[category]]: [[valueGX]]"
  },{
    "id": "g2",
    "bullet": "square",
    "title": "Y軸 陀螺儀感測器",
    "valueField": "valueGyroY",
    "type": "smoothedLine",
    "balloonText": "[[category]]: [[valueGY]]"
  },{
    "id": "g3",
    "bullet": "round",
    "lineColor": "#FF6600",
    "title": "Ｚ軸 陀螺儀感測器",
    "valueField": "valueGyroZ",
    "type": "smoothedLine",
    "balloonText": "[[category]]: [[valueGZ]]"
  }],
  "categoryField": "date",
  "categoryAxis": {
    "parseDates": false,
    "equalSpacing": true,
    "dashLength": 10,
    "minorGridEnabled": true,
  },
  // "startDate" :
  "synchronizeGrid":true,
  "dataProvider": chartData
});


/*
 * Called during the onmessage event. Your application will need
 * to parse  your websocket server's response into a data object
 * or array of dataObjects your chart expects
*/



var socket = io.connect(baseURL+":3000");
var a;
var i=0
socket.on('news', function (data) {
  a = data;
  // var newData = data.hello.hello.new_val.dataset.map(p=>({
  //   value:p.GravityX,
  //   // GRAVITY_Y:p.GRAVITY[1],
  //   // GRAVITY_Z:p.GRAVITY[2,
  //   date:p.Time
  // }));
  // var timestamp = 1293683278;
  var mydate = new Date(data.hello.hello.new_val.dataset.Time*1);

  var newDataGravity = [{
    valueGX:data.hello.hello.new_val.dataset.GravityX,
    valueGY:data.hello.hello.new_val.dataset.GravityY,
    valueGZ:data.hello.hello.new_val.dataset.GravityZ,
    valueAX:data.hello.hello.new_val.dataset.AccelerometerX,
    valueAY:data.hello.hello.new_val.dataset.AccelerometerY,
    valueAZ:data.hello.hello.new_val.dataset.AccelerometerZ,
    valueGyroX:data.hello.hello.new_val.dataset.GyroscopeX,
    valueGyroY:data.hello.hello.new_val.dataset.GyroscopeY,
    valueGyroZ:data.hello.hello.new_val.dataset.GyroscopeZ,

    date:mydate.getHours()+":"+mydate.getMinutes()+":"+mydate.getSeconds(),

    }];
  var newDataAccelerate = [{
    valueAY:data.hello.hello.new_val.dataset.AccelerometerY,
    valueAZ:data.hello.hello.new_val.dataset.AccelerometerZ,
    date:mydate.getHours()+":"+mydate.getMinutes()+":"+mydate.getSeconds()
    }];
  var newDataGyro = [{
    valueGyroX:data.hello.hello.new_val.dataset.GyroscopeX,
    valueGyroY:data.hello.hello.new_val.dataset.GyroscopeY,
    valueGyroZ:data.hello.hello.new_val.dataset.GyroscopeZ,
    date:mydate.getHours()+":"+mydate.getMinutes()+":"+mydate.getSeconds()
    }];

  chartData.push.apply(chartData, newDataGravity);
  chartData2.push.apply(chartData2, newDataAccelerate);
  chartData3.push.apply(chartData3, newDataGyro);

  // keep only 50 datapoints on screen for the demo
  if (chartData.length > 10) {
    chartData.splice(0, chartData.length - 10);
  }
  if (chartData2.length > 10) {
    chartData2.splice(0, chartData2.length - 10);
  }
  if (chartData3.length > 10) {
    chartData3.splice(0, chartData3.length - 10);
  }

  // writeToScreen("<span style='color: blue'>Received: " + wsEvent.data + "</span>");
  chart.validateData(); //call to redraw the chart with new data
  chart2.validateData(); //call to redraw the chart with new data
  chart3.validateData(); //call to redraw the chart with new data

  // socket.emit('my other event', { my: 'data' });
});

  </script>

  </body>
</html>
